# 2019-12-10

|Time|Icon|Name|Message|
|---|---|---|---|
|02:46|![](https://secure.gravatar.com/avatar/7fef90f6ef611e0cc71857ab8251f0c8.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0006-72.png)|U|`@shinyu` 了解しました。 `2019.11.100-pre` とそのチェンジログのコミットまでをリリース境界にします。<br>それでは異論が無ければ **12/14** に移行を実施します。<br>`@Johannes Wilm` もし `vivliostyle-print` で現在作業中のタスクがある場合は教えて下さい。<br><br>vivliostyle.js, vivliostyle-ui, vivliostyle-print それぞれに未マージのブランチ並びに PR が無いことをチェックしました。<br>移行手順を文書化しましたので、見落としている視点があれば教えてください。<br><br>1. 3 つのリポジトリの `master` を `vivliostyle` にマージする<br>   2. `vivliostyle.js` の `master` をベースにして `monorepo` ブランチを作成し、 `/` 以下を `/packages/core` に移動するコミットを行う<br>   3. `vivliostyle` の `master` に `vivliostyle.js` の `monorepo` をマージする。<br>   4. `vivliostyle-ui` の `master` をベースにして `monorepo` ブランチを作成し、 `/` 以下を `/packages/viewer` に移動するコミットを行う<br>   5. `vivliostyle` の `master` に `vivliostyle-ui` の `monorepo` をマージする。<br>   6. `vivliostyle-print` の `master` をベースにして `monorepo` ブランチを作成し、 `/` 以下を `/packages/print` に移動するコミットを行う<br>   7. `vivliostyle` の `master` に `vivliostyle-print` の `monorepo` をマージする。<br>   8. 古い名称を新しい名称に書き換える<br>   9. lerna をセットアップする<br>2. `gh-pages` の移行<br>   1. `vivliostyle.js` の `gh-pages` ブランチを `vivliostyle` の `gh-pages` にマージする<br>   2. `/vivliostyle` をルートにしてファイルを移動する<br>   3. `vivliostyle-print` の `gh-pages` ブランチを `vivliostyle` の `gh-pages` にマージする<br>   4. `/print` をルートにしてファイルを移動する<br>5. CI の移行<br>   1. `vivliostyle/packages/core` の `build/update-version.sh` を修正<br>   2. `vivliostyle/packages/viewer` の `scripts/update-version.sh` を修正<br>6. `vivliostyle-savepdf` の移行<br>   1. `vivliostyle-savepdf` を `vivliostyle-cli` にリネーム<br>   2. 古い名称を新しい名称に書き換える<br>9. 新しいバージョンを npm にリリースする<br>   1. `vivliostyle/packages/core` の `master` を `@vivliostyle/core` の `v2.0.0-rc.0` としてリリース<br>   2. `vivliostyle/packages/viewer` の `master` を `@vivliostyle/viewer` の `v2.0.0-rc.0` としてリリース<br>   3. `vivliostyle/packages/print` の `master` を `@vivliostyle/print` の `v2.0.0-rc.0` としてリリース<br>   4. `vivliostyle-cli` の `master` を `@vivliostyle/cli` の `v2.0.0-rc.0` としてリリース<br>   5. テスト（修正は `v2.0.0-rc.1` 、 `v2.0.0-rc.2` のようにリリースする）<br>   6. 問題が解決したら、すべてのパッケージを `v2.0.0` でリリースする<br><br>&lt;https://github.com/vivliostyle/vivliostyle/issues/2&gt;<br><blockquote><https://user-images.githubusercontent.com/431808/70374919-7a123580-193b-11ea-8084-803523e6f19a.png|Vivliostyle 2020><br><br>*What will happen*<br><br>• Adopt monorepo scheme for core packages (<https://github.com/vivliostyle/vivliostyle/issues/1|#1>)<br>• Rename npm modules along with a scoped namespace (<https://www.npmjs.com/org/vivliostyle|@vivliostyle>)<br>• Introduce semantic versioning (initial version is v2.0.0)<br><br>*Schedule*<br>*Rename repository (2019/12/14)*<br><br>• Rename GitHub repo (`vivliostyle/vivliostyle-savepdf`) to `vivliostyle/vivliostyle-cli`<br>• Rewrite `package.json` and respective files to match its new name.<br><br>*Merge repositories (2019/12/14)*<br><br>• Merge `vivliostyle.js` commit history with `vivliostyle/vivliostyle#/packages/core`<br>• Merge `vivliostyle-ui` commit history with `vivliostyle/vivliostyle#/packages/viewer`<br>• Merge `vivliostyle-print` commit history with `vivliostyle/vivliostyle#/packages/print`<br><br>*Release scoped versions in npm (2019/12/14)*<br><br>• `vivliostyle/vivliostyle#/packages/core` as `@vivliostyle/core#v2.0.0`<br>• `vivliostyle/vivliostyle#/packages/viewer` as `@vivliostyle/viewer#v2.0.0`<br>• `vivliostyle/vivliostyle#/packages/print` as `@vivliostyle/print#v2.0.0`<br>• `vivliostyle/vivliostyle-cli` as `@vivliostyle/cli#v2.0.0`<br><br>*Test and fix npm related issue (2019/12/14)*<br><br>• `npm i &lt;scoped package&gt;`<br>• `lerna test`<br>• etc<br><br>*Transfer issues (2019/12/14)*<br><br>• Issues from `vivliostyle/vivliostyle.js` to `vivliostyle`<br>• Issues from `vivliostyle/vivliostyle-ui` to `vivliostyle`<br><br>*Mark old repositories deprecated (2019/12/14)*<br><br>• Add notice and redirection to `vivliostyle/vivliostyle.js`<br>• Add notice and redirection to `vivliostyle/vivliostyle-ui`<br>• Add notice and redirection to `vivliostyle/vivliostyle-print`<br><br>*`npm deprecate` (2019/12/14)*<br><br>• `vivliostyle`<br>• `vivliostyle-savepdf`<br>• `vivliostyle-print`<br><br>*Archive deprecated repositories (Early 2020)*<br><br>• `vivliostyle/vivliostyle.js`<br>• `vivliostyle/vivliostyle-ui`<br>• `vivliostyle/vivliostyle-print`</blockquote>|
|03:06|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|`@U` Vivliostyle Viewer のgithub-pagesのURLは現在 `<https://vivliostyle.github.io/vivliostyle.js/viewer/vivliostyle-viewer.html>` ですが、新しいURLは `<https://vivliostyle.github.io/vivliostyle/viewer/vivliostyle-viewer.html>` ですね？<br>古いURLは `version: 2019.11.100-pre` のまま更新されないで、当面そのままですね？|
|03:06|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧:  The URL of Vivliostyle Viewer's github-pages is currently `<https://vivliostyle.github.io/vivliostyle.js/viewer/vivliostyle-viewer.html>`, but the new URL is `&lt;https: //vivliostyle.github .io / vivliostyle / viewer / vivliostyle-viewer.html&gt; `right?<br>The old URL is `version: 2019.11.100-pre` and will not be updated.|
|03:20|![](https://secure.gravatar.com/avatar/7fef90f6ef611e0cc71857ab8251f0c8.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0006-72.png)|U|`@shinyu` そうです。新しいURLではバージョン表記もすべてv2.0.0に変更したいと思います。前のバージョンは `&lt;https://vivliostyle.github.io/vivliostyle.js/viewer/vivliostyle-viewer.html&gt;` でサーブされるので、`v2.0.0` を使いたい人は新しいURLを単に使えば良く、古いURLを使っている人は、古いバージョンをそのまま使い続けることができます。|
|03:20|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧:  That's right. I would like to change the version notation to v2.0.0 for all new URLs. The previous version is served by `<https://vivliostyle.github.io/vivliostyle.js/viewer/vivliostyle-viewer.html>`, so if you want to use `v2.0.0` you can simply use the new URL If you use old URLs, you can continue to use the old version.|
|06:11|![](https://secure.gravatar.com/avatar/7fef90f6ef611e0cc71857ab8251f0c8.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0006-72.png)|U|試験的に現在のsnapshotを使用してローカル環境でMonorepoを作ってみました。node_modulesを直接参照しているコードの多くを書き換える必要がありましたが無事に動かすことができました。<br>以下の点が新たにわかりました。<br>1. モジュールごとに異なっているprettierルールと.editorconfigをDX向上のため統一し、husky等を使用してコミット時に一括fixしたい<br>2. コードフォーマットに関係の無いeslintルールはそのままモジュールごとに独立させる<br>3. viewerとcoreの.travis.ymlはマージする必要がある|
|06:11|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧: I tried to make Monorepo in the local environment using the current snapshot as a test. I had to rewrite much of the code that directly referenced node_modules, but it worked.<br>The following points were newly found.<br>1. I want to unify prettier rules and .editorconfig that are different for each module to improve DX, and use husky etc. to batch fix<br>2. Make eslint rules unrelated to code format independent for each module<br>3. Viewer and core .travis.yml need to be merged|
|10:10|![](https://secure.gravatar.com/avatar/7fef90f6ef611e0cc71857ab8251f0c8.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0006-72.png)|U|`vivliostyle-print` を `vivliostyle.js` とマージして `import {print} from '@vivliostyle/core'` のような形で使用可能にするアイディアが `@Johannes Wilm` さんから出されました。もしcoreの責任者である村上さんが大丈夫であればMonorepoの後にマージするPRを出そうと思っています。|
|10:10|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧: An idea for merging `vivliostyle-print` with` vivliostyle.js` to make it usable in the form of `import {print} from '@ vivliostyle / core'`. If Mr. Murakami, who is in charge of the core, is all right, I would like to issue a PR that merges after Monorepo.|
|10:28|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|なるほど `@vivliostyle/core` に print も含めるのですね。良いと思います。|
|10:28|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧: I see, print is included in `@ vivliostyle / core`. I think it's good.|
|10:32|![](https://secure.gravatar.com/avatar/7fef90f6ef611e0cc71857ab8251f0c8.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0006-72.png)|U|`@shinyu` ありがとうございます。それではマージする方針で進めます！|
|10:32|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧:  Thank you very much. Let's proceed with the merge policy!|
|10:33|![](https://secure.gravatar.com/avatar/7fef90f6ef611e0cc71857ab8251f0c8.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0006-72.png)|U|https://vivliostyle.slack.com/files/UK1GQ9TF0/FRK3H3A30/vivliostyle_2020.png|
|10:33|![](https://secure.gravatar.com/avatar/7fef90f6ef611e0cc71857ab8251f0c8.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0006-72.png)|U|https://vivliostyle.slack.com/files/UK1GQ9TF0/FRJNNE5AT/module_structure.png|
|10:35|![](https://secure.gravatar.com/avatar/7fef90f6ef611e0cc71857ab8251f0c8.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0006-72.png)|U|現状の方向性やアイディアをまとめました。より良いアイディアがあればコメントください🚀|
|10:35|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧: A summary of the current direction and ideas. Please comment if you have a better idea: rocket:|
