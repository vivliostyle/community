# 2025-07-03

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|00:54|![](https://avatars.slack-edge.com/2023-07-29/5658697640674_f6bd020434e09212481e_72.png)|Gen|基本的なことですみません、表紙を別ファイルで入稿したいので、目次から原稿ファイルをスタートさせ、`pageCounterReset`で目次を2ページ目としてノンブルを振ろうとしています。<br>シンプルにtechbookテーマで動作確認しようとしているのですが、`build`でも`preview`でもノンブルの番号が変わりません。`.vivliostyle`を削除して試しても同様でした。実装としてはpageCounterResetを定義すると`@page :nth(1) {  counter-reset: page ${Math.floor(pageCounterReset - 1)};` を挿入するだけのように見えるのですが、テーマとの競合があると動作しませんか？<br>```module.exports = {<br>  title: "***",<br>  author: "Gen",<br>  language: "ja",<br>  size: "JIS-A5",<br>  theme: ["@vivliostyle/theme-techbook"], // .css or local dir or npm package. default to undefined<br>  entry: [<br>    {<br>      path: "toc.md",<br>      rel: "contents",<br>      pageCounterReset: 2,<br>    },<br>    "chapter0/intro.md",<br>    "chapter99/outro.md",<br>  ],<br>  entryContext: "./contents",<br>  workspaceDir: ".vivliostyle",<br>  output: "./output/***.pdf", //最終成果物（入稿用PDF）を出力するファイルパス<br>  toc: true,<br>};```|
|13:56|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|見てみました。生成されたtocファイル（`path: "toc.md"` の指定があるので.mdファイルだけど中身はHTML）には次のようにstyle要素があります。<br>```&lt;style data-vv-style=""&gt;<br><br>@page :nth(1) {<br>  counter-reset: page 1;<br>}<br>&lt;/style&gt;&lt;link rel="stylesheet" type="text/css" href="themes/node_modules/@vivliostyle/theme-techbook/theme.css"&gt;<pre>style要素のあとにlink要素でtheme-techbook/theme.cssが読み込まれるようになってます。そして、そこからimportされるtheme-base/theme-all.cssからimportされるtheme-base/css/partial/page.css に次のルールがありました：</pre>@page :first {<br>  counter-reset: vs-counter-doc vs-counter-part vs-counter-chapter<br>    var(--vs-first-page-counter-reset,);<br>}```<br>style要素で指定された `@page :nth(1)` と page.css にある `@page :first` はページセレクタの詳細度が同じなので後にある `@page :first` の `counter-reset` のほうが優先されることになります。したがって `counter-reset: page 1;` は効果がありません。<br>CSS変数 `--vs-first-page-counter-reset` は未定義なのでこのcounter-resetではカウンター `page` はリセットされません（pageは0にリセットされて最初のページで1になるというデフォルト動作のまま）。<br><br>Vivliostyle CLI のissueにします|
|14:21|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|<https://github.com/vivliostyle/vivliostyle-cli/issues/619><br><blockquote>from Slack <https://vivliostyle.slack.com/archives/CJRP7PK6K/p1751504064651379|https://vivliostyle.slack.com/archives/CJRP7PK6K/p1751504064651379><br><br>> 表紙を別ファイルで入稿したいので、目次から原稿ファイルをスタートさせ、`pageCounterReset`で目次を2ページ目としてノンブルを振ろうとしています。  <br>> シンプルにtechbookテーマで動作確認しようとしているのですが、`build`でも`preview`でもノンブルの番号が変わりません。`.vivliostyle`を削除して試しても同様でした。実装としてはpageCounterResetを定義すると`@page :nth(1) { counter-reset: page ${Math.floor(pageCounterReset - 1)};` を挿入するだけのように見えるのですが、テーマとの競合があると動作しませんか？<br>> <br>> module.exports = {<br>>  title: "***",<br>>  author: "Gen",<br>>  language: "ja",<br>>  size: "JIS-A5",<br>>  theme: ["@vivliostyle/theme-techbook"], // .css or local dir or npm package. default to undefined<br>>  entry: [<br>>    {<br>>      path: "toc.md",<br>>      rel: "contents",<br>>      pageCounterReset: 2,<br>>    },<br>>    "chapter0/intro.md",<br>>    "chapter99/outro.md",<br>>  ],<br>>  entryContext: "./contents",<br>>  workspaceDir: ".vivliostyle",<br>>  output: "./output/***.pdf", //最終成果物（入稿用PDF）を出力するファイルパス<br>>  toc: true,<br>> };<br><br>生成されたtocファイル（`path: "toc.md"` の指定があるので.mdファイルだけど中身はHTML）には次のようにstyle要素があります。<br><br><style data-vv-style=""><br><br>@page :nth(1) {<br>  counter-reset: page 1;<br>}<br></style><link rel="stylesheet" type="text/css" href="themes/node\_modules/@vivliostyle/theme-techbook/theme.css"><br><br>style要素のあとにlink要素でtheme-techbook/theme.cssが読み込まれるようになってます。そして、そこからimportされるtheme-base/theme-all.cssからimportされるtheme-base/css/partial/page.css に次のルールがありました：<br><br>@page :first {<br>  counter-reset: vs-counter-doc vs-counter-part vs-counter-chapter<br>    var(--vs-first-page-counter-reset,);<br>}<br><br>style要素で指定された `@page :nth(1)` と page.css にある `@page :first` はページセレクタの詳細度が同じなので後にある `@page :first` の `counter-reset` のほうが優先されることになります。したがって `counter-reset: page 1;` は効果がありません。  <br>CSS変数 `--vs-first-page-counter-reset` は未定義なのでこのcounter-resetではカウンター `page` はリセットされません（pageは0にリセットされて最初のページで1になるというデフォルト動作のまま）。<br><br>### 修正案<br><br>pageカウンタをリセットするstyle要素がthemeのスタイルシートのlink要素の前にあることで無効になってるのですが、かといって順番を入れ替えれば、themeのスタイルシートにある `@page :first` での counter-reset が無効になってしまいます。そこで、次のようにCSS変数 `--vs-first-page-counter-reset` をセットするようにしたらよいのでないかと思います。<br><br>@page :nth(1) {<br>  --vs-first-page-counter-reset: page ${Math.floor(pageCounterReset - 1)};<br>  counter-reset: var(--vs-first-page-counter-reset);<br>}<br><br>これにより、themeの使用の有無にかかわらずpageCounterResetの指定通りにpageカウンターのリセットができるようになると思います。</blockquote>|
