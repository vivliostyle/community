# 2025-02-25

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|23:40|![](https://avatars.slack-edge.com/2025-02-25/8534676346416_8dc396ac83e514211a95_72.png)|hajime maru|Windows環境でjsからvivliostyleを実行するとPDFの内部リンクが外部リンクになる。<br><br><br>■ 環境<br><br>- Vivliostyle:<br>    - cli: 8.18.0<br>    - core: 2.31.0<br>- Node.js: v20.12.2<br>- Shell: PowerShell<br>- OS: Windows 11<br><br>■ 再現手順<br><br>Create Bookにて作成されたサンプルページのmanuscript.mdを次のように変更し<br>```# 吾輩は猫である。<br><br>[表題へのリンク](#吾輩は猫である)<pre>node buildPdf.jsPowerShellで上記を実行します。<br><br>buildPdf.js</pre>main1();<br>function main1() {<br>    const configjs = "vivliostyle.config.js"<br>    execSync(`npx vivliostyle build -c ${configjs} -o mybook.pdf` );<br>};<pre><br>[表題へのリンク]のリンク先は次になります。  `file:///C:/~~~~~~~~~~/manuscript.html#吾輩は猫である`<br><br>gitに付属の bash から実行すると、正しく内部リンクになります。<br><br>デバッグログを確認してみました。bashとの違いは、参照しているファイルパスのドライブレターが小文字か大文字かでした。<br><br>■ 回避策<br><br>`vivliostyle.config.js`をフルパスで取得し、ドライブレターを大文字にしました。<br></pre>node buildPdf2.js<pre>PowerShellで上記を実行します。<br><br>buildPdf2.js</pre>main2();<br>function main2() {<br>    const scriptdir = __dirname;<br>    const configjs = "vivliostyle.config.js"<br>    const configjsFullPath = path.join(scriptdir.replace(/^c:\\/, "C:\\"), configjs);<br>    execSync(`npx vivliostyle build -c ${configjsFullPath} -o mybook2.pdf` );<br>};```<br>正しく内部リンクとなっていました。<br><br>このような方法で、問題ないでしょうか。|
