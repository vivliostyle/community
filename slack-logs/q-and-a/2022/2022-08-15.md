# 2022-08-15

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|09:22|![](https://avatars.slack-edge.com/2022-08-21/3992344751120_5c9be0c9169540de7e40_72.jpg)|信国幸彦|*Vivliostyle Viewerで使うWebサーバについて*<br><br>はじめまして。<br><br>EPUBの点検業務のため、職場のLAN上で稼働中のWebサーバ（Windows 10 マシン上のIIS。名前はhppd600-014）にVivliostyle Viewerを組み込んで、EPUBをフロア内の複数のPCから閲覧しようとしています。<br><br>*<http://hppd600-014/vivliostyle/*> を公開ディレクトリとして、その中にVivliostyle Viewerの配布パッケージの内容を全部コピーしました。また公開ディレクトリにEPUBの格納フォルダを*products*として作成し、その中にEPUBファイル（を解凍したフォルダ）を1つ、*beta08*として置きました。<br><br>つまり、Vivliostyle ViewerのURLは*<http://hppd600-014/vivliostyle/viewer/*、EPUBフォルダのURLは*http://hppd600-014/vivliostyle/products/beta08/*となるようにしました。><br><br>こうして、LAN上のPCからGoogle Chromeで、EPUBフォルダ内のXHTMLファイル（nav.xhtml）を相対パスで指定し`<http://hppd600-014/vivliostyle/viewer/#src=../products/beta08/nav.xhtml&amp;bookMode=true>` というパラメータ付きURLで接続すると、綺麗に表示されました。目次パネルも有効になっていて、閲覧しやすいです。感激です。ありがとうございます。<br><br>しかし、EPUBを閲覧するときはEPUBフォルダのURLでパラメータを指定するのがユーザーガイド（<https://docs.vivliostyle.org/#/ja/vivliostyle-viewer#epub>）に書かれた仕様です。ところが、それに従って `<http://hppd600-014/vivliostyle/viewer/#src=../products/beta08/&amp;bookMode=true>` で接続すると次のようなエラーメッセージが出てしまい、ビューア内はずっとダウンロード中表示のままです。<br><br><blockquote>Error: Failed to fetch EPUB OPF <http://hppd600-014/vivliostyle/products/beta08/content.opf> (404 Not Found)</blockquote>content.opfというファイルは間違いなくこのURLに置いてあります。なぜ取ってこれないのでしょう。ただファイルを配置するだけでなくIISで何かの設定を変更のうえ再起動するなどの必要があるのでしょうか。あるいはIISではそもそもいけないでしょうか。<br><br>あまりに初歩のインストール段階の質問で大変申し訳ないのですが、ご教示いただけると幸いです。|
|09:22|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: *Web server used by Vivliostyle Viewer*<br><br>Nice to meet you.<br><br>For EPUB inspection work, I installed Vivliostyle Viewer in a web server (IIS on a Windows 10 machine, named hppd600-014) running on the LAN at work, and tried to view EPUB from multiple PCs on the floor. is.<br><br>*<http://hppd600-014/vivliostyle/*> is a public directory, and I copied all the contents of the Vivliostyle Viewer distribution package into it. In addition, I created an EPUB storage folder as *products* in the public directory, and placed one EPUB file (the folder where it was unzipped) in it as *beta08*.<br><br>In other words, the Vivliostyle Viewer URL is *<http://hppd600-014/vivliostyle/viewer/*、EPUBフォルダのURLは*http://hppd600-014/vivliostyle/products/beta08/*となるようにしました。><br><br>In this way, when I specified the XHTML file (nav.xhtml) in the EPUB folder with a relative path using Google Chrome from a PC on the LAN and connected with a URL with a parameter called `<http://hppd600-014/vivliostyle/viewer/#src=../products/beta08/nav.xhtml&amp;bookMode=true>`, it was displayed beautifully. The Table of Contents panel is also enabled and easy to browse. I'm deeply moved. Thank you.<br><br>However, when browsing EPUB, it is the specification written in the user guide (<https://docs.vivliostyle.org/#/ja/vivliostyle-viewer#epub>) to specify parameters with the URL of the EPUB folder. However, when I follow the instructions and connect with `<http://hppd600-014/vivliostyle/viewer/#src=../products/beta08/&amp;bookMode=true>`, I get the following error message, and the viewer keeps showing that it is downloading.<br><br><blockquote>Error: Failed to fetch EPUB OPF <http://hppd600-014/vivliostyle/products/beta08/content.opf> (404 Not Found)</blockquote>The file content.opf is definitely located at this URL. Why can't I get it? Is it necessary not only to place files but also to change some settings in IIS and restart? Or should IIS not do that at all?<br><br>I am very sorry for the question at the installation stage of too elementary, but I would appreciate it if you could teach me.|
|09:49|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|<http://hppd600-014/vivliostyle/products/beta08/content.opf><br><br>というファイルが実際にこのURLにあるのに "(404 Not Found)" のエラーになるのが謎ですね。ブラウザでこのURLを開くとファイル内容（XMLデータあるいはテキストファイルとして内容）が表示されるのですね？<br><br>このOPFのURLを直接Vivliostyle Viewerに指定した場合はどうでしょうか？<br><br>`<http://hppd600-014/vivliostyle/viewer/#src=../products/beta08/content.opf&amp;bookMode=true>`<br>あるいは<br>`<http://hppd600-014/vivliostyle/viewer/#src=http://hppd600-014/vivliostyle/products/beta08/content.opf&amp;bookMode=true>`|
|09:49|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: <http://hppd600-014/vivliostyle/products/beta08/content.opf><br><br>It's a mystery that the "(404 Not Found)" error occurs even though the file actually exists at this URL. If you open this URL in your browser, the file contents (as XML data or as a text file) will be displayed, right?<br><br>What about if you specify the URL of this OPF directly to the Vivliostyle Viewer?<br><br>`<http://hppd600-014/vivliostyle/viewer/#src=../products/beta08/content.opf&amp;bookMode=true>`<br>or<br>`<http://hppd600-014/vivliostyle/viewer/#src=http://hppd600-014/vivliostyle/products/beta08/content.opf&amp;bookMode=true>`|
|10:13|![](https://avatars.slack-edge.com/2022-08-21/3992344751120_5c9be0c9169540de7e40_72.jpg)|信国幸彦|早速にご対応いただきありがとうございます。OPFファイルのURLを指定しても（相対パスもプロトコルからの指定も）どちらもやはり同じエラーメッセージが出ます。<br><br><blockquote>ブラウザでこのURLを開くとファイル内容（XMLデータあるいはテキストファイルとして内容）が表示されるのですね？</blockquote>とのご質問をいただいて、？と思い、<br><http://hppd600-014/vivliostyle/products/beta08/content.opf><br>をブラウザで開いたことはなかったので開いてみたところ、これもやはり404エラーになりました。<br><br>IISは拡張子OPFのファイルの存在を認めないってことかな？|
|10:14|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: Thank you for your prompt response. Even if I specify the URL of the OPF file (both relative path and specification from the protocol), I still get the same error message.<br><br><blockquote>If you open this URL in your browser, the file contents (as XML data or as a text file) will be displayed, right?</blockquote>Thank you for your question, ? I thought,<br><http://hppd600-014/vivliostyle/products/beta08/content.opf><br>I had never opened it in a browser, so when I opened it, it also resulted in a 404 error.<br><br>Does IIS not allow files with the extension OPF to exist?|
|10:28|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|<blockquote>とのご質問をいただいて、？と思い、<br><http://hppd600-014/vivliostyle/products/beta08/content.opf><br>をブラウザで開いたことはなかったので開いてみたところ、これもやはり404エラーになりました。</blockquote>ブラウザで開けないURLは Vivliostyle.js でも開けないです。<br>まず、そのURLがブラウザで404エラーにならないようにしてください。|
|10:28|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: &gt; I thought,<br><blockquote><http://hppd600-014/vivliostyle/products/beta08/content.opf></blockquote>I had never opened &gt; in a browser, so when I opened it, it also resulted in a 404 error.<br>URLs that cannot be opened in a browser cannot be opened in Vivliostyle.js.<br>First, make sure that URL doesn't result in a 404 error in your browser.|
|10:30|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|「IIS 拡張子」でググると次のような記事がありました。<br><https://itp.blog.ss-blog.jp/2013-05-23><br><br><blockquote>IISで特定のファイルがダウンロードできない場合の解決方法　<https://itp.blog.ss-blog.jp/archive/c2303110543-1|[Windows Server 2012]><br>IISでは、特定のファイルがダウンロードできない場合があります。<br>原因は、IISのMIMEにダウンロードできないファイルの拡張子が登録されていないからです。</blockquote><br><blockquote>IISでは、特定のファイルがダウンロードできない場合があります。原因は、IISのMIMEにダウンロードできないファイルの拡張子が登録されていないからです。エラーが発生した場合は、以下のような画面が表示されます。HTTPエラー404.3以下、対応方法です。（１）サーバマネージャを開き、[ツール]-[インターネットインフォメーションマネージャ]をクリックします。（２）設定するWebサイトを選択して、右ペインより「MIMEの種類」をクリックします。※今回はサイトを選択しましたが、サーバを選択するとIIS全体での指定が可能です。（３）右端の「追加」ボタンをクリックします。（４）以下のように設定し、「OK」ボタンをクリックします。ファイル名の拡張子：ダウンロードするファイルの拡張子（今回は、.vbe）MIMEの種類：application/octet-stream(5)これで開くようになります。</blockquote><br><blockquote>自分の為のメモ。でもみんなの役に立てば嬉しいです。誤りがあれば、がんがん指摘お願いします。</blockquote>|
|10:30|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: I found the following article when I googled "IIS extension".<br><https://itp.blog.ss-blog.jp/2013-05-23><br><br><blockquote>Solution when a specific file cannot be downloaded with IIS <https://itp.blog.ss-blog.jp/archive/c2303110543-1|[Windows Server 2012]><br>IIS may not be able to download certain files.<br>The reason is that the extension of the file that cannot be downloaded is not registered in MIME of IIS.</blockquote>|
|13:33|![](https://avatars.slack-edge.com/2022-08-21/3992344751120_5c9be0c9169540de7e40_72.jpg)|信国幸彦|ありがとうございます。IISマネージャでIISが取り扱うMIMEの種類として追加しなければ拡張子OPFのファイルはIISに存在を認めてもらえないのですね。<br><br>追加したら、EPUBのフォルダを指定して表示させることができました！<br><br>Vivliostyleの問題ではないこのようなことまで調べていただいて、誠に恐縮です。<br>深く感謝申し上げます。<br><br>なお、OPFはTextタイプのデータだと思うのですが<https://www.iana.org/assignments/media-types/media-types.xhtml|IANAのMedia Typesのページ>にはOPFは載っていなかったので、詳細不明で名もなき拡張子について使うらしいMIMEタイプの`application/octet-stream`にしました。|
|13:33|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: Thank you. If you don't add it as a MIME type handled by IIS in the IIS manager, files with the extension OPF won't be recognized by IIS.<br><br>After adding it, I was able to specify and display the EPUB folder!<br><br>I'm really sorry that you even investigated this kind of thing that is not a problem of Vivliostyle.<br>Thank you very much.<br><br>I think that OPF is Text type data, but <https://www.iana.org/assignments/media-types/media-types.xhtml|IANAのMedia Typesのページ> did not include OPF, so I set it to `application/octet-stream`, a MIME type that seems to be used for unnamed extensions with unknown details. did.|
|14:49|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|OPFファイルのMIMEタイプは `application/oebps-package+xml` です。仕様→ <https://www.w3.org/publishing/epub3/epub-packages.html#sec-package-content-conf><br><br><https://www.iana.org/assignments/media-types/media-types.xhtml|IANAのMedia Typesのページ>にもあります（見つけにくいですね）。<br><blockquote>This specification defines semantics and conformance requirements for an EPUB® Package. Each Package represents one Rendition of an EPUB Publication, and is defined by a Package Document that describes the content of the Rendition and sets the requirements for how Publication Resources are associated.</blockquote>|
|14:49|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: The MIME type for OPF files is `application/oebps-package+xml`. Specifications → <https://www.w3.org/publishing/epub3/epub-packages.html#sec-package-content-conf><br><br>Also in <https://www.iana.org/assignments/media-types/media-types.xhtml|IANAのMedia Typesのページ> (hard to find).|
