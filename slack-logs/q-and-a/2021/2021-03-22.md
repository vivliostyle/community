# 2021-03-22

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|07:31|![](https://avatars.slack-edge.com/2019-05-15/624511073651_25909952cd7a069ceed2_72.png)|akabeko|macOS にて `~/Download/あ/` というマルチバイト文字を含むパス上に create-book で `sample` というプロジェクトを作成して `npm run preview` するとプレビューは起動されますが JavaScript は `Uncaught URIError: URI malformed` でエラーとなりました。`~/Download/a/` のように ASCII のみなら正常動作します。<br><br>FAQ や vivliostyle.js の issue にそれらしいものはないようですが既出でしょうか？エラーの内容こそ異なりますが以下と関連して現状の Vivliostyle として非 ASCII のパスは避けたほうがよいならば FAQ に記載しておくとよさそうです。<br><br>Non-ASCII directory/file is not available. Error: Validation of pubManifest failed. · Issue #155 · vivliostyle/vivliostyle-cli<br><https://github.com/vivliostyle/vivliostyle-cli/issues/155><br><blockquote>@vivliostyle/cli 3.1.2<br><br>Windows10上で以下の`vivliostyle.config.js`を作成しました。<br><br><pre>module.exports = {<br>  title: 'test',<br>  entry: ['テスト.html']<br>};<br></pre><br><br>同じディレクトリに`テスト.html`を作成した上で`vivliostyle build`を実行すると以下のビルドエラーが発生しました。<br><br><pre>× Error: Validation of pubManifest failed. Please check the schema: C:/vivliostyletest/publication.json<br>    at generateManifest (C:\vivliostyletest\node_modules\@vivliostyle\cli\dist\builder.js:74:15)<br>    at Object.compile (C:\vivliostyletest\node_modules\@vivliostyle\cli\dist\builder.js:163:9)<br>    at build (C:\vivliostyletest\node_modules\@vivliostyle\cli\dist\commands\build.js:56:25)<br>    at processTicksAndRejections (node:internal/process/task_queues:94:5)<br></pre><br><br><https://github.com/vivliostyle/vivliostyle-cli/blob/1f1e48f19d20d53ebe555a5f47f28861959466ac/src/builder.ts#L103|vivliostyle-cli/src/builder.ts><br><br>Line 103 in &lt;/vivliostyle/vivliostyle-cli/commit/1f1e48f19d20d53ebe555a5f47f28861959466ac|1f1e48f&gt;<br><br>  <br>を確認し、ajv.validateに渡されているpublicationの中身を出力してみたところ、以下が出力されていました。<br><br><pre>{<br>  '@context': [ '<https://schema.org>', '<https://www.w3.org/ns/pub-context>' ],<br>  type: 'Book',<br>  conformsTo: '<https://github.com/vivliostyle/vivliostyle-cli>',<br>  author: '',<br>  dateModified: '2021-03-13T08:45:18.817Z',<br>  name: 'test',<br>  readingOrder: [ { url: 'テスト.html', title: 'test' } ],<br>  resources: [],<br>  links: []<br>}<br></pre><br><br>validation時にencodeURIでエンコードされたパスが渡されていないからのように見えたので、<br><br><https://github.com/vivliostyle/vivliostyle-cli/blob/1f1e48f19d20d53ebe555a5f47f28861959466ac/src/builder.ts#L49|vivliostyle-cli/src/builder.ts><br><br>Line 49 in &lt;/vivliostyle/vivliostyle-cli/commit/1f1e48f19d20d53ebe555a5f47f28861959466ac|1f1e48f&gt;<br><br>  <br>をurl: encodeURI(entry.path)  <br>と変更したところビルドに成功しました。<br><br>また、以下のようにディレクトリがNon-ASCIIの場合も同様の現象が発生し、同じ処置でビルドに成功しました。<br><br><pre>module.exports = {<br>  title: 'test',<br>  entry: ['./テスト/test.html']<br>};<br></pre></blockquote>|
|07:31|![](https://avatars.slack-edge.com/2021-03-01/1807880975282_5c8ad89e782096649baa_72.png)|Kiara : Language Translation Bot|🇬🇧: On macOS, create a project called `sample` with create-book on the path containing the multibyte character` ~ / Download / A / `and` npm run preview` will start the preview, but JavaScript will start` Uncaught URIError An error occurred with: URI malformed`. Only ASCII, such as `~ / Download / a /`, works fine.<br><br>There seems to be no such thing in the FAQ or vivliostyle.js issue, but is it already mentioned? The content of the error is different, but if you should avoid non-ASCII paths as the current Vivliostyle in relation to the following, it seems better to mention it in the FAQ.<br><br>Non-ASCII directory / file is not available. Error: Validation of pubManifest failed. · Issue # 155 · vivliostyle / vivliostyle-cli<br><https://github.com/vivliostyle/vivliostyle-cli/issues/155>|
|08:31|![](https://avatars.slack-edge.com/2019-05-15/624511073651_25909952cd7a069ceed2_72.png)|akabeko|create-book で theme に slide を選び、それを FAQ の「テーマをカスタマイズするには？」に従って CSS をカスタマイズ可能な状態にしました。そして色々といじっているのですが<br>1. CSS 保存時にプレビューを自動リロードさせる方法はありますか？<br>2. `vivliostyle.config.js` 保存時にプレビューを再起動させず反映させる方法はありますか？<br>3. プレビュー (Vivliostyle Viewer？) で Chromium の開発者ツールから要素を探すとスタイルがインライン展開されるようですが、この情報を元に CSS ファイル上の定義を探すよい方法はありますか？<br>1 は Markdown 保存時と同様の挙動を期待しています。現在は CSS を保存した後に手動でリロードしています。2 は設計的に自動リロードは難しいとしても手動リロードで反映されるとありがたいです。<br><br>3 はクラス名が失われるようなので CSS 側へ意図的におかしな色を指定するなどして、手探りで対応箇所を探しています。HTML 要素に `data-original-define="body &gt; section &gt; h2"` のような感じで CSS の元定義が出力されているとかするとありがたいですね (そういう要望を Core の issue に挙げるほうがよい？)。|
|08:31|![](https://avatars.slack-edge.com/2021-03-01/1807880975282_5c8ad89e782096649baa_72.png)|Kiara : Language Translation Bot|🇬🇧: In create-book, I chose slide as the theme and made it customizable by following the FAQ "How to customize the theme?". And I'm playing around with it<br>1. Is there a way to automatically reload the preview when saving CSS?<br>2. Is there a way to reflect the preview without restarting when saving `vivliostyle.config.js`?<br>3. Looking for an element in Chromium's developer tools in the preview (Vivliostyle Viewer?) Seems to inline the style. Is there a good way to use this information to find the definition in the CSS file?<br>1 expects the same behavior as when saving Markdown. I'm currently saving the CSS and then reloading it manually. 2 is difficult to reload automatically by design, but I would appreciate it if it is reflected by manual reloading.<br><br>3 seems to lose the class name, so I'm trying to find a corresponding part by intentionally specifying a strange color on the CSS side. It would be nice if the original definition of CSS was output to the HTML element like `data-original-define =" body &amp; gt; section &amp; gt; h2 "` (It is better to list such a request in the Core issue). ?).|
|09:51|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|1.については <https://github.com/vivliostyle/vivliostyle-cli/pull/149> で修正したつもりだったのが不完全でバグがあったのに気づきました。修正pull reqします。<br><br>このバグを回避するにはvivliostyle.config.js に `workspaceDir` の設定を入れることです。<br><br>2.については、configを更新するたびに vivliostyle preview を再起動するしかないですね。<br><br>3.は要望issueをcoreのほうにどうぞ<br><blockquote>Fixes the following problems:<br><br>• On Windows, `process.cwd()` returns Windows path containing backslashes  <br>    and it causes problem when matching with `startsWith()` to other paths  <br>    that are normalized using forward slashes.<br>• When config file is not used, `workspaceDir` and `entryContextDir` are  <br>    set to the directory containing the input file. In this condition,  <br>    file changes inside that directory (`p.startsWith(config.workspaceDir)`)  <br>    are ignored, but file changes in the current directory are watched.  <br>    This is contrary to the expected behavior.<br>• XHTML, EPUB (.epub or .opf), pub-manifest (.json) input are ignored.</blockquote>|
|09:51|![](https://avatars.slack-edge.com/2021-03-01/1807880975282_5c8ad89e782096649baa_72.png)|Kiara : Language Translation Bot|🇬🇧: Regarding 1., I noticed that there was a bug that I intended to fix at <https://github.com/vivliostyle/vivliostyle-cli/pull/149>. Fix pull req.<br><br>To work around this bug, put the `workspaceDir` setting in vivliostyle.config.js.<br><br>Regarding 2., I have no choice but to restart vivliostyle preview every time I update the config.<br><br>3. Please send the requested issue to the core|
|10:15|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|1.の修正についてはpull reqにしましたので確認お願いします `@akabeko` `@spring-raining` :<br><https://github.com/vivliostyle/vivliostyle-cli/pull/159><br><br>2.の修正もほしいところですよね。どなたかお願いしたいです。<br><blockquote>This is a follow-up fix of <https://github.com/vivliostyle/vivliostyle-cli/pull/149|#149>.</blockquote>|
|10:15|![](https://avatars.slack-edge.com/2021-03-01/1807880975282_5c8ad89e782096649baa_72.png)|Kiara : Language Translation Bot|🇬🇧: Please confirm the correction of 1. as it is a pull req.<br><https://github.com/vivliostyle/vivliostyle-cli/pull/159><br><br>I would also like to see the correction in 2. I would like to ask someone.|
|13:10|![](https://avatars.slack-edge.com/2019-05-15/624511073651_25909952cd7a069ceed2_72.png)|akabeko|3 について issue を書こうとして気づいたのですが、例えば slide theme だと CSS クラス名が登場しないので個々をきちんと見てゆけば対応付けできますね。というわけで issue は出さないでおきます。|
|13:10|![](https://avatars.slack-edge.com/2021-03-01/1807880975282_5c8ad89e782096649baa_72.png)|Kiara : Language Translation Bot|🇬🇧: I noticed when I tried to write an issue about 3, but for example, in the slide theme, the CSS class name does not appear, so if you look at each one properly, you can associate it. That's why I don't issue an issue.|
