# 2021-11-28

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|09:44|![](https://avatars.slack-edge.com/2021-11-28/2760484838823_4e3ce5c4a1c8bdf8d04e_72.png)|Gen|はじめまして、C99に向けてVivliostyleでPDF作成しようとしているところです。<br>初歩的な質問で恐縮ですが、`vivliostyle build` を実行したところ、下記のエラーメッセージが出ました。メッセージ通りに取ると、HTML→PDFの段階でエラーになっているよう読めるので、元になるMarkdownファイルを編集してHTMLを修正しようとしているのですが、`"line":702`はどの部分を指しているのか確認可能でしょうか。<br>複数あるHTMLファイルを合計した際の行を見に行けばいいかと考え、中間生成されたHTMLを頭から行数を足していったところ、該当部分はheadタグ内だったので、可能性は低そうだと判断しました。<br>```◡ Building PDFTrying to parse invalid object: {"line":702,"column":1797,"offset":25288371})<br>Invalid object ref: 85 0 R<br>✖ Error: Failed to parse PDF document (line:702 col:1797 offset=25288371): Failed to parse invalid PDF object<br>    at PDFInvalidObjectParsingError.PDFParsingError [as constructor] (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/pdf-lib/cjs/core/errors.js:229:24)<br>    at new PDFInvalidObjectParsingError (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/pdf-lib/cjs/core/errors.js:262:24)<br>    at PDFParser.tryToParseInvalidIndirectObject (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/pdf-lib/cjs/core/parser/PDFParser.js:181:19)<br>    at PDFParser.&lt;anonymous&gt; (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/pdf-lib/cjs/core/parser/PDFParser.js:209:30)<br>    at step (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/pdf-lib/node_modules/tslib/tslib.js:141:27)<br>    at Object.throw (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/pdf-lib/node_modules/tslib/tslib.js:122:57)<br>    at rejected (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/pdf-lib/node_modules/tslib/tslib.js:113:69)```|
|09:44|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: Nice to meet you, I'm trying to create a PDF in Vivliostyle for C99.<br>Excuse me for the rudimentary question, but when I ran `vivliostyle build`, I got the following error message: If you take it according to the message, it can be read as an error at the stage of HTML → PDF, so I am trying to edit the original Markdown file and correct the HTML, but which part is `" line ": 702`? Is it possible to confirm that it points to?<br>I thought that I should go to see the line when summing multiple HTML files, and when I added the number of lines from the beginning of the intermediately generated HTML, the corresponding part was in the head tag, so the possibility is low. I decided so.<br>`` `◡ Building PDFTrying to parse invalid object: {"line ": 702," column ": 1797," offset ": 25288371})<br>Invalid object ref: 85 0 R<br>✖ Error: Failed to parse PDF document (line: 702 col: 1797 offset = 25288371): Failed to parse invalid PDF object<br>    at PDFInvalidObjectParsingError.PDFParsingError [as constructor] (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/pdf-lib/cjs/core/errors.js:229:24)<br>    at new PDFInvalidObjectParsingError (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/pdf-lib/cjs/core/errors.js:262:24)<br>    at PDFParser.tryToParseInvalidIndirectObject (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/pdf-lib/cjs/core/parser/PDFParser.js:181:19)<br>    at PDFParser. &amp; lt; anonymous &amp; gt; (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/pdf-lib/cjs/core/parser/PDFParser.js:209:30)<br>    at step (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/pdf-lib/node_modules/tslib/tslib.js:141:27)<br>    at Object.throw (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/pdf-lib/node_modules/tslib/tslib.js:122:57)<br>    at rejected (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/pdf-lib/node_modules/tslib/tslib.js:113:69) `` `|
|10:17|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|このエラーメッセージを見ると、PDFの後処理（Chromiumで出力されたPDFにメタ情報を加えるなど）のために使われているライブラリ pdf-lib でエラーが起きています。`"line":702` はPDFファイルの中の問題箇所でしょう。<br>`vivliostyle preview` でプレビュー表示してそこから印刷→PDF保存した場合は正常にPDFができますか？|
|10:17|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: If you see this error message, there is an error in the library pdf-lib used for PDF post-processing (such as adding meta information to the PDF output by Chromium). `" line ": 702` is probably the problem in the PDF file.<br>If I use `vivliostyle preview` to preview and print from there → save as PDF, can PDF be created normally?|
|10:55|![](https://avatars.slack-edge.com/2021-11-28/2760484838823_4e3ce5c4a1c8bdf8d04e_72.png)|Gen|`@shinyu` 回答ありがとうございます。WSL2で`vivliostyle preview` が動いてくれないので、確認できない状況です。こちらはPuppeteerのエラーなので、こちらで伺うのはスレ違いかなと思っております。（参考までにエラーを添付します）<br><br>なお、人力で問題箇所特定（画像ファイルサイズが10MB以上で大きすぎたようです）はできました<br>```✖ Error: Failed to launch the browser process!<br>[6564:6564:1128/195335.957282:FATAL:<http://gtk_compat.cc|gtk_compat.cc>(45)] Check failed: !check || library. <br>#0 0x55f656c47f49 base::debug::CollectStackTrace()<br>#1 0x55f656bb1933 base::debug::StackTrace::StackTrace()<br>#2 0x55f656bc5500 logging::LogMessage::~LogMessage()<br>#3 0x55f656bc604e logging::LogMessage::~LogMessage()<br>#4 0x55f659c7cc6c gtk::(anonymous namespace)::LoadGtkImpl()<br>#5 0x55f659c7c90b gtk::LoadGtk()<br>#6 0x55f659c778ac gtk::GtkUi::GtkUi()<br>#7 0x55f659c7771b BuildGtkUi()<br>#8 0x55f659b73268 ChromeBrowserMainExtraPartsViewsLinux::ToolkitInitialized()<br>#9 0x55f6567d0f59 ChromeBrowserMainParts::ToolkitInitialized()<br>#10 0x55f6548a8133 content::BrowserMainLoop::InitializeToolkit()<br>#11 0x55f6548a8acd content::BrowserMainRunnerImpl::Initialize()<br>#12 0x55f6548a4bdb content::BrowserMain()<br>#13 0x55f65676246a content::ContentMainRunnerImpl::RunBrowser()<br>#14 0x55f656761fdd content::ContentMainRunnerImpl::Run()<br>#15 0x55f65675f7cb content::RunContentProcess()<br>#16 0x55f6567600cd content::ContentMain()<br>#17 0x55f6535d2b11 ChromeMain<br>#18 0x7ff3a838a0b3 __libc_start_main<br>#19 0x55f6535d292a _start<br><br>[1128/195336.069255:ERROR:<http://file_io_posix.cc|file_io_posix.cc>(144)] open /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq: No such file or directory (2)<br>[1128/195336.069325:ERROR:<http://file_io_posix.cc|file_io_posix.cc>(144)] open /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq: No such file or directory (2)<br>Received signal 6<br>#0 0x55f656c47f49 base::debug::CollectStackTrace()<br>#1 0x55f656bb1933 base::debug::StackTrace::StackTrace()<br>#2 0x55f656c47a21 base::debug::(anonymous namespace)::StackDumpSignalHandler()<br>#3 0x7ff3a945d3c0 (/usr/lib/x86_64-linux-gnu/libpthread-2.31.so+0x153bf)<br>#4 0x7ff3a83a918b gsignal<br>#5 0x7ff3a8388859 abort<br>#6 0x55f656c46cb5 base::debug::BreakDebugger()<br>#7 0x55f656bc5927 logging::LogMessage::~LogMessage()<br>#8 0x55f656bc604e logging::LogMessage::~LogMessage()<br>#9 0x55f659c7cc6c gtk::(anonymous namespace)::LoadGtkImpl()<br>#10 0x55f659c7c90b gtk::LoadGtk()<br>#11 0x55f659c778ac gtk::GtkUi::GtkUi()<br>#12 0x55f659c7771b BuildGtkUi()<br>#13 0x55f659b73268 ChromeBrowserMainExtraPartsViewsLinux::ToolkitInitialized()<br>#14 0x55f6567d0f59 ChromeBrowserMainParts::ToolkitInitialized()<br>#15 0x55f6548a8133 content::BrowserMainLoop::InitializeToolkit()<br>#16 0x55f6548a8acd content::BrowserMainRunnerImpl::Initialize()<br>#17 0x55f6548a4bdb content::BrowserMain()<br>#18 0x55f65676246a content::ContentMainRunnerImpl::RunBrowser()<br>#19 0x55f656761fdd content::ContentMainRunnerImpl::Run()<br>#20 0x55f65675f7cb content::RunContentProcess()<br>#21 0x55f6567600cd content::ContentMain()<br>#22 0x55f6535d2b11 ChromeMain<br>#23 0x7ff3a838a0b3 __libc_start_main<br>#24 0x55f6535d292a _start<br>  r8: 0000000000000000  r9: 00007ffe14c796f0 r10: 0000000000000008 r11: 0000000000000246<br> r12: 00003db8002b9540 r13: 00007ffe14c79950 r14: 00003db8002b9550 r15: aaaaaaaaaaaaaaaa<br>  di: 0000000000000002  si: 00007ffe14c796f0  bp: 00007ffe14c79940  bx: 00007ff3a71c8500<br>  dx: 0000000000000000  ax: 0000000000000000  cx: 00007ff3a83a918b  sp: 00007ffe14c796f0<br>  ip: 00007ff3a83a918b efl: 0000000000000246 cgf: 002b000000000033 erf: 0000000000000000<br> trp: 0000000000000000 msk: 0000000000000000 cr2: 0000000000000000<br>[end of stack trace]<br><br><br>TROUBLESHOOTING: <https://github.com/puppeteer/puppeteer/blob/main/docs/troubleshooting.md><br><br>    at onClose (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/puppeteer-core/lib/cjs/puppeteer/node/BrowserRunner.js:197:20)<br>    at ChildProcess.&lt;anonymous&gt; (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/puppeteer-core/lib/cjs/puppeteer/node/BrowserRunner.js:188:79)<br>    at ChildProcess.emit (node:events:402:35)<br>    at Process.ChildProcess._handle.onexit (node:internal/child_process:290:12)```|
|10:55|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧:  thank you for your answer. The `vivliostyle preview` doesn't work on WSL2, so I can't confirm it. This is a Puppeteer error, so I think it's a mistake to ask here. (An error is attached for reference)<br><br>In addition, I was able to identify the problematic part manually (it seems that the image file size was 10 MB or more and it was too large).<br>`` `✖️ Error: Failed to launch the browser process!<br>[6564: 6564: 1128/195335.957282: FATAL: <http://gtk_compat.cc|gtk_compat.cc> (45)] Check failed:! check || library.<br># 0 0x55f656c47f49 base :: debug :: CollectStackTrace ()<br># 1 0x55f656bb1933 base :: debug :: StackTrace :: StackTrace ()<br># 2 0x55f656bc5500 logging :: LogMessage :: ~ LogMessage ()<br># 3 0x55f656bc604e logging :: LogMessage :: ~ LogMessage ()<br># 4 0x55f659c7cc6c gtk :: (anonymous namespace) :: LoadGtkImpl ()<br># 5 0x55f659c7c90b gtk :: LoadGtk ()<br># 6 0x55f659c778ac gtk :: GtkUi :: GtkUi ()<br># 7 0x55f659c7771b BuildGtkUi ()<br># 8 0x55f659b73268 ChromeBrowserMainExtraPartsViewsLinux :: ToolkitInitialized ()<br># 9 0x55f6567d0f59 ChromeBrowserMainParts :: ToolkitInitialized ()<br># 10 0x55f6548a8133 content :: BrowserMainLoop :: InitializeToolkit ()<br># 11 0x55f6548a8acd content :: BrowserMainRunnerImpl :: Initialize ()<br># 12 0x55f6548a4bdb content :: BrowserMain ()<br># 13 0x55f65676246a content :: ContentMainRunnerImpl :: RunBrowser ()<br># 14 0x55f656761fdd content :: ContentMainRunnerImpl :: Run ()<br># 15 0x55f65675f7cb content :: RunContentProcess ()<br># 16 0x55f6567600cd content :: ContentMain ()<br># 17 0x55f6535d2b11 ChromeMain<br># 18 0x7ff3a838a0b3 __libc_start_main<br># 19 0x55f6535d292a _start<br><br>[1128/195336.069255: ERROR: <http://file_io_posix.cc|file_io_posix.cc> (144)] open /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq: No such file or directory (2)<br>[1128/195336.069325: ERROR: <http://file_io_posix.cc|file_io_posix.cc> (144)] open /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq: No such file or directory (2)<br>Received signal 6<br># 0 0x55f656c47f49 base :: debug :: CollectStackTrace ()<br># 1 0x55f656bb1933 base :: debug :: StackTrace :: StackTrace ()<br># 2 0x55f656c47a21 base :: debug :: (anonymous namespace) :: StackDumpSignalHandler ()<br># 3 0x7ff3a945d3c0 (/usr/lib/x86_64-linux-gnu/libpthread-2.31.so+0x153bf)<br># 4 0x7ff3a83a918b gsignal<br># 5 0x7ff3a8388859 abort<br># 6 0x55f656c46cb5 base :: debug :: BreakDebugger ()<br># 7 0x55f656bc5927 logging :: LogMessage :: ~ LogMessage ()<br># 8 0x55f656bc604e logging :: LogMessage :: ~ LogMessage ()<br># 9 0x55f659c7cc6c gtk :: (anonymous namespace) :: LoadGtkImpl ()<br># 10 0x55f659c7c90b gtk :: LoadGtk ()<br># 11 0x55f659c778ac gtk :: GtkUi :: GtkUi ()<br># 12 0x55f659c7771b BuildGtkUi ()<br># 13 0x55f659b73268 ChromeBrowserMainExtraPartsViewsLinux :: ToolkitInitialized ()<br># 14 0x55f6567d0f59 ChromeBrowserMainParts :: ToolkitInitialized ()<br># 15 0x55f6548a8133 content :: BrowserMainLoop :: InitializeToolkit ()<br># 16 0x55f6548a8acd content :: BrowserMainRunnerImpl :: Initialize ()<br># 17 0x55f6548a4bdb content :: BrowserMain ()<br># 18 0x55f65676246a content :: ContentMainRunnerImpl :: RunBrowser ()<br># 19 0x55f656761fdd content :: ContentMainRunnerImpl :: Run ()<br># 20 0x55f65675f7cb content :: RunContentProcess ()<br># 21 0x55f6567600cd content :: ContentMain ()<br># 22 0x55f6535d2b11 ChromeMain<br># 23 0x7ff3a838a0b3 __libc_start_main<br># 24 0x55f6535d292a _start<br>  r8: 0000000000000000 r9: 00007ffe14c796f0 r10: 0000000000000008 r11: 0000000000000246<br> r12: 00003db8002b9540 r13: 00007ffe14c79950 r14: 00003db8002b9550 r15: aaaaaaaaaaaaaaaa<br>  di: 0000000000000002 si: 00007ffe14c796f0 bp: 00007ffe14c79940 bx: 00007ff3a71c8500<br>  dx: 0000000000000000 ax: 0000000000000000 cx: 00007ff3a83a918b sp: 00007ffe14c796f0<br>  ip: 00007ff3a83a918b efl: 0000000000000246 cgf: 002b000000000033 erf: 0000000000000000<br> trp: 0000000000000000 msk: 0000000000000000 cr2: 0000000000000000<br>[end of stack trace]<br><br><br>TROUBLESHOOTING: <https://github.com/puppeteer/puppeteer/blob/main/docs/troubleshooting.md><br>|
|10:55|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|    at onClose (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/puppeteer-core/lib/cjs/puppeteer/node/BrowserRunner.js: 197: 20)<br>    at ChildProcess. &amp; lt; anonymous &amp; gt; (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/puppeteer-core/lib/cjs/puppeteer/node/BrowserRunner.js:188:79)<br>    at ChildProcess.emit (node: events: 402:35)<br>    at Process.ChildProcess._handle.onexit (node: internal / child_process: 290: 12) `` ``|
|11:58|![](https://avatars.slack-edge.com/2021-11-28/2760484838823_4e3ce5c4a1c8bdf8d04e_72.png)|Gen|WSL2でGUIアプリを利用できるようにしたところ、preview可能になりました。元の画像を再度参照して試したところ、Preview→DL可能でした。<br>また、Buildの方もファイルを置き直しただけで成功するようになりました…お騒がせしました<br>`@shinyu`|
|11:58|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: When I made the GUI application available on WSL2, it became possible to preview. When I referred to the original image again and tried it, Preview → DL was possible.<br>Also, Build is now successful just by repositioning the files ...<br>|
