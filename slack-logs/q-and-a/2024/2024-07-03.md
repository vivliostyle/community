# 2024-07-03

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|02:17|![](https://secure.gravatar.com/avatar/071ca54af656223d6d39098e0598e777.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0022-72.png)|藤井太洋|昨日尋ねた件ですが、vivliostyle previewにURLを渡すとソースファイルのwatchが機能しないことがわかりました。<br>サンプルのソースコードを置いておきます。<br><br>```const cp = require("node:child_process");<br>const path = require("path");<br>const url = require('url');<br><br>const relativePath = './classes.html';<br>const absolutePath = path.resolve(relativePath);<br>const fileUri = url.pathToFileURL(absolutePath).toString();<br><br>// 更新しない<br>const processUrl = cp.exec(`vivliostyle preview ${fileUri}`);<br><br>// 更新する<br>const processPath = cp.exec(`vivliostyle preview ${relativePath}`);```|
|02:48|![](https://secure.gravatar.com/avatar/071ca54af656223d6d39098e0598e777.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0022-72.png)|藤井太洋|尋ねた件ですが、解決しました。URLで開いたときは更新が機能しないようです。<br><https://vivliostyle.slack.com/archives/CJRP7PK6K/p1719973045634599><br><blockquote>昨日尋ねた件ですが、vivliostyle previewにURLを渡すとソースファイルのwatchが機能しないことがわかりました。<br>サンプルのソースコードを置いておきます。<br><br>```const cp = require("node:child_process");<br>const path = require("path");<br>const url = require('url');<br><br>const relativePath = './classes.html';<br>const absolutePath = path.resolve(relativePath);<br>const fileUri = url.pathToFileURL(absolutePath).toString();<br><br>// 更新しない<br>const processUrl = cp.exec(`vivliostyle preview ${fileUri}`);<br><br>// 更新する<br>const processPath = cp.exec(`vivliostyle preview ${relativePath}`);```</blockquote>|
|03:40|![](https://secure.gravatar.com/avatar/071ca54af656223d6d39098e0598e777.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0022-72.png)|藤井太洋|なおWindowsでは、URLで起動した場合でもwatchが動作します。|
|05:30|![](https://avatars.slack-edge.com/2023-11-11/6180804843906_ec36242e3b721d6c30e9_72.png)|Koutaro Mukai|こちらはmacOSで試してみましたが、再現しませんでした。killによってChromeごと終了できているように見えます。<br>```% sw_vers <br>ProductName:		macOS<br>ProductVersion:		14.5<br>BuildVersion:		23F79<br>% node --version &amp;&amp; vivliostyle --version<br>v20.15.0<br>cli: 8.12.1<br>core: 2.30.1<br>% cat kill_child.js <br>const cp = require("node:child_process");<br>const process = cp.exec("vivliostyle preview test.html");<br><br>setTimeout(() =&gt; {<br>    process.kill();<br>    console.log("Process terminated after 3 seconds");<br>}, 3000);<br>% node kill_child.js                    <br>Process terminated after 3 seconds<br>% ps aux | grep chrome<br>mukai             2195   0.0  0.0 33591680    192 s001  R+    2:19PM   0:00.00 grep chrome```|
|06:54|![](https://secure.gravatar.com/avatar/071ca54af656223d6d39098e0598e777.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0022-72.png)|藤井太洋|nodeのバージョンを合わせてみましたが、こちらではchromeが終了できません。cp.spawnでpidを取得すると、起動時のプロセスはkillされているのですが子プロセスはkillできていないようです。<br>```% sw_vers              <br>ProductName:		macOS<br>ProductVersion:		14.1.1<br>BuildVersion:		23B81<br>% node --version && vivliostyle --version<br>v20.15.0<br>cli: 7.2.2<br>core: 2.24.2<br>% cat child_process.js <br>const cp = require("node:child_process");<br>const process = cp.exec("vivliostyle preview classes.html");<br><br>setTimeout(() => {<br>  process.kill();<br>  console.log("Process terminated after 3 seconds");<br>}, 3000);<br><br>taiyofujii@MacBook-Pro Wizardry % node child_process.js<br>Process terminated after 3 seconds<br>^C```|
