# 2021-01-03

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|02:09|![](https://secure.gravatar.com/avatar/bce57b78a27111affe9a9a95fb793798.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0021-72.png)|kauplan|あけましておめでとうございます。<br>`npm create book mybook` がエラーになり、初手で躓いています。アドバイスがほしいのですが、ここで聞いてもいいでしょうか。（q-and-a チャネルと違いが分からず）|
|02:09|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧: happy New Year.<br>`npm create book mybook` is getting an error and I'm stumbling on my first move. I'd like some advice, can I ask here? (I don't know the difference from the q-and-a channel)|
|02:30|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|はい、issues はエラーが起きるなど不具合と思われることに関するチャンネルなので、どうぞよろしくお願いします。（q-and-a は使い方の質問など）|
|02:30|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧: Yes, issues is a channel about what seems to be a bug, such as an error, so thank you. (Q-and-a is a question about how to use it, etc.)|
|02:36|![](https://secure.gravatar.com/avatar/bce57b78a27111affe9a9a95fb793798.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0021-72.png)|kauplan|ありがとうございます。<br>次のような `npm create book mybook` のエラーで躓いています。<br>もしバグ登録すべきならそうするので、「バグ登録すべき」と言ってください。<br><br>### Docker on Macでエラー<br><br>```$ docker run -it ubuntu:20.04 /bin/bash<br># apt update<br># apt install nodejs npm<br># node -v<br>v10.19.0<br># mkdir /var/work<br># cd /var/work<br># npm create book mybook1<br><br>Install for create-book@latest failed with code 1<pre>### Macでエラー<br></pre>$ node -v<br>v14.14.0<br>$ npm create book mybook<br># TypeError<br>Cannot read property 'name' of undefined<br><br>TypeError: Cannot read property 'name' of undefined<br>    at /Users/kauplan/.npm/_npx/87560/lib/node_modules/create-book/node_modules/create-create-app/lib/chunk.TQKs_zbg.js1️⃣4550<br>    at Generator.next (&lt;anonymous&gt;)<br>    at d (/Users/kauplan/.npm/_npx/87560/lib/node_modules/create-book/node_modules/create-create-app/lib/chunk.TQKs_zbg.js1️⃣239)<br><br># Environment<br>- create-create-app: 6.0.1<br>- System &gt; OS: macOS Mojave 10.14.6<br>- Binaries &gt; Node: 14.14.0 - /usr/local/node/14.14.0/bin/node<br><br>If you think this is a bug, please report at <https://github.com/uetchy/create-create-app/issues> along with the information above.```<br>`chunk.TQKs_zbg.js` でエラーになってるけどこのファイルがないし、あったとしてもminifyされてるようだから中を調査しにくいでしょう（mapファイルの有無も分からない）。<br>なにかアドバイスをお願いします。|
|04:20|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|いくつかの環境(macOS 11.1 + node.js v15.3.0, macOS 10.13.6 + node v14.14.0, v10.19.0など)で試してなかなか再現せず（エラーにならず正常に実行できる）、<br>それから上の「Docker on Macでエラー」と同じことをしたところ<br>```Install for create-book@latest failed with code 1<pre>となることは確認できました。このDocker上のubuntu:20.04 + node v10.19.0 でのエラーと、「Macでエラー」（こちらで再現できてない）が同じ問題かどうか分かりません。</pre>TypeError<br>Cannot read property 'name' of undefined```<br>がどこで起きる可能性があるかみてみますね|
|04:20|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧: I tried it in some environments (macOS 11.1 + node.js v15.3.0, macOS 10.13.6 + node v14.14.0, v10.19.0, etc.) and it didn't reproduce easily (it can be executed normally without error).<br>Then I did the same thing as "Error on Docker on Mac" above<br>`` `Install for create-book @ latest failed with code 1```<br>I was able to confirm that. I'm not sure if the error on ubuntu: 20.04 + node v10.19.0 on this Docker and the "error on Mac" (which I can't reproduce here) are the same problem.<br>`` `TypeError<br>Cannot read property'name' of undefined```<br>Let's see where it can happen|
|06:06|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|Docker上のubuntu:20.04 + node v10.19.0 での<br>```Install for create-book@latest failed with code 1<pre>ですが、 `npm create book mybook1` の代わりに次のようにしたら、動きました。</pre># npm install -g create-book<br># create-book mybook1```<br>`@kauplan` 試してみてください。|
|06:06|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧: On ubuntu: 20.04 + node v10.19.0 on Docker<br>`` `Install for create-book @ latest failed with code 1```<br>But instead of `npm create book mybook1` I did the following and it worked.<br>`` `# npm install -g create-book<br># create-book mybook1```<br> try it.|
|07:03|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|```TypeError<br>Cannot read property 'name' of undefined<pre>が起きる条件が分かりました。<br>git の設定（`~/.gitconfig` ファイル）が存在するが、`user.name` が設定されていない場合にこのエラーになります。次の設定をすると解決するはずです。</pre>git config --global user.name "ユーザー名"```<br>前に "Handle errors when git is missing" というissue<br><https://github.com/vivliostyle/create-book/issues/1><br>があって、それはcreate-bookが依存するcreate-create-appの<br><https://github.com/uetchy/create-create-app/commit/2f3e50a033c05b42924b8c356a46c97e4c4d05b8><br>で修正されていたのですが、gitの設定が存在するがuserが設定されていないという場合についてはまだ直っていなかったというものですね。その修正のプルリクなどしておきます。<br><blockquote>[vivliostyle/create-book] #1 Handle errors when git is missing</blockquote>|
|07:03|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧: `` `TypeError<br>Cannot read property'name' of undefined<pre>I understand the conditions under which.<br>You will get this error if the git configuration (`~ / .gitconfig` file) exists but` user.name` is not set. The following settings should solve the problem.</pre> git config --global user.name" username "` ``<br>Previously the issue "Handle errors when git is missing"<br><https://github.com/vivliostyle/create-book/issues/1><br>There is a create-create-app that the create-book depends on<br><https://github.com/uetchy/create-create-app/commit/2f3e50a033c05b42924b8c356a46c97e4c4d05b8><br>It was fixed in, but if the git setting exists but the user is not set, it has not been fixed yet. I will pull the correction etc.|
|08:26|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|<https://github.com/vivliostyle/create-book/issues/15><br><https://github.com/uetchy/create-create-app/pull/26><br><blockquote>[vivliostyle/create-book] #15 Crashes when .gitconfig exists but user is not set</blockquote><br><blockquote>[uetchy/create-create-app] #26 fix: avoid crashes when .gitconfig exists but user is not set</blockquote>|
|08:26|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧: <https://github.com/vivliostyle/create-book/issues/15><br><https://github.com/uetchy/create-create-app/pull/26><br>🇯🇵: <https://github.com/vivliostyle/create-book/issues/15><br><https://github.com/uetchy/create-create-app/pull/26>|
|10:46|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|Docker上のubuntu:20.04 + nodejs v10.19.0 でインストールが失敗するのは別の問題でした。aptでインストールされるnodejsのバージョンが古いためです。<br><https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-20-04-ja><br>これの「オプション2」を参考に nodejs のバージョンを新しいもの(v14.15.3)にしたところ、インストールは成功するようになりました。<br>ただし、npm run build を実行すると（vivliostyle buildの実行になる）、次のエラーになります：<br>```✖ Error: Failed to launch the browser process!<br>/var/work/mybook1/node_modules/puppeteer/.local-chromium/linux-818858/chrome-linux/chrome: error while loading shared libraries: libnss3.so: cannot open shared object file: No such file or directory<br><br><br>TROUBLESHOOTING: <https://github.com/puppeteer/puppeteer/blob/main/docs/troubleshooting.md>```<br>chrome-linuxが依存するライブラリのインストールが必要なようです:<br><https://github.com/puppeteer/puppeteer/blob/main/docs/troubleshooting.md#chrome-headless-doesnt-launch-on-unix><br><blockquote>このガイドでは、Ubuntu 20.04サーバーにNode.jsをインストールする3種類の方法を示します。 ひとつは、Ubuntuのデフォルトのソフトウェアリポジトリからaptを使用してnodejsパッケージをインストールする方法、次に、代替PPAソフトウェアリポジトリからaptを使用して指定したバージョンのnodejsパッケージをインストールする方法、最後に、Nodeバージョンマネージャーをインストールし、これを使って複数のバージョンのnodejsをインストール・管理する方法について説明します。</blockquote>|
|10:46|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧: The installation failure with ubuntu: 20.04 + nodejs v10.19.0 on Docker was another issue. This is because the version of nodejs installed by apt is old.<br><https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-20-04-ja><br>I updated the version of nodejs to the new version (v14.15.3) by referring to "Option 2" of this, and the installation was successful.<br>However, when I run npm run build (which results in running vivliostyle build), I get the following error:<br>`` `✖ Error: Failed to launch the browser process!<br>/var/work/mybook1/node_modules/puppeteer/.local-chromium/linux-818858/chrome-linux/chrome: error while loading shared libraries: libnss3.so: cannot open shared object file: No such file or directory<br><br><br>TROUBLESHOOTING: <https://github.com/puppeteer/puppeteer/blob/main/docs/troubleshooting.md> `` `<br>It looks like you need to install the libraries that chrome-linux depends on:<br><https://github.com/puppeteer/puppeteer/blob/main/docs/troubleshooting.md#chrome-headless-doesnt-launch-on-unix><br><blockquote><pre># Troubleshooting<br><br>&lt;!-- GEN:toc --&gt;<br>- [Chrome headless doesn't launch on Windows](#chrome-headless-doesnt-launch-on-windows)<br>- [Chrome headless doesn't launch on UNIX](#chrome-headless-doesnt-launch-on-unix)<br>- [Chrome is downloaded but fails to launch on Node.js 14](#chrome-is-downloaded-but-fails-to-launch-on-nodejs-14)<br>- [Setting Up Chrome Linux Sandbox](#setting-up-chrome-linux-sandbox)<br>  * [[recommended] Enable user namespace cloning](#recommended-enable-user-namespace-cloning)<br>  * [[alternative] Setup setuid sandbox](#alternative-setup-setuid-sandbox)<br>- [Running Puppeteer on Travis CI](#running-puppeteer-on-travis-ci)<br>- [Running Puppeteer on CircleCI](#running-puppeteer-on-circleci)<br>- [Running Puppeteer in Docker](#running-puppeteer-in-docker)<br>  * [Running on Alpine](#running-on-alpine)<br>    - [Tips](#tips)<br>- [Running Puppeteer in the cloud](#running-puppeteer-in-the-cloud)<br>  * [Running Puppeteer on Google App Engine](#running-puppeteer-on-google-app-engine)<br>  * [Running Puppeteer on Google Cloud Functions](#running-puppeteer-on-google-cloud-functions)<br>  * [Running Puppeteer on Heroku](#running-puppeteer-on-heroku)<br>  * [Running Puppeteer on AWS Lambda](#running-puppeteer-on-aws-lambda)<br>- [Code Transpilation Issues](#code-transpilation-issues)<br>&lt;!-- GEN:stop --&gt;<br><br>## Chrome headless doesn't launch on Windows<br><br>Some [chrome policies](<https://support.google.com/chrome/a/answer/7532015>) might enforce running Chrome/Chromium<br>with certain extensions.<br><br>Puppeteer passes `--disable-extensions` flag by default and will fail to launch when such policies are active.<br><br>To work around this, try running without the flag:<br></pre>js<br>const browser = await puppeteer.launch({<br>  ignoreDefaultArgs: ['--disable-extensions'],<br>});<br><pre><br><blockquote>Context: [issue 3681](<https://github.com/puppeteer/puppeteer/issues/3681#issuecomment-447865342>).</blockquote>## Chrome headless doesn't launch on UNIX<br><br>Make sure all the necessary dependencies are installed. You can run `ldd chrome | grep not` on a Linux<br>machine to check which dependencies are missing. The common ones are provided below.<br><br>&lt;details&gt;<br>&lt;summary&gt;Debian (e.g. Ubuntu) Dependencies&lt;/summary&gt;<br></pre><br>ca-certificates<br>fonts-liberation<br>libappindicator3-1<br>libasound2<br>libatk-bridge2.0-0<br>libatk1.0-0<br>libc6<br>libcairo2<br>libcups2<br>libdbus-1-3<br>libexpat1<br>libfontconfig1<br>libgbm1<br>libgcc1<br>libglib2.0-0<br>libgtk-3-0<br>libnspr4<br>libnss3<br>libpango-1.0-0<br>libpangocairo-1.0-0<br>libstdc++6<br>libx11-6<br>libx11-xcb1<br>libxcb1<br>libxcomposite1<br>libxcursor1<br>libxdamage1<br>libxext6<br>libxfixes3<br>libxi6<br>libxrandr2<br>libxrender1<br>libxss1<br>libxtst6<br>lsb-release<br>wget<br>xdg-utils<br><pre>&lt;/details&gt;<br><br>&lt;details&gt;<br>&lt;summary&gt;CentOS Dependencies&lt;/summary&gt;<br></pre><br>alsa-lib.x86_64<br>atk.x86_64<br>cups-libs.x86_64<br>gtk3.x86_64<br>ipa-gothic-fonts<br>libXcomposite.x86_64<br>libXcursor.x86_64<br>libXdamage.x86_64<br>libXext.x86_64<br>libXi.x86_64<br>libXrandr.x86_64<br>libXScrnSaver.x86_64<br>libXtst.x86_64<br>pango.x86_64<br>xorg-x11-fonts-100dpi<br>xorg-x11-fonts-75dpi<br>xorg-x11-fonts-cyrillic<br>xorg-x11-fonts-misc<br>xorg-x11-fonts-Type1<br>xorg-x11-utils<br><pre><br>After installing dependencies you need to update nss library using this command<br></pre><br>yum update nss -y<br><pre>&lt;/details&gt;<br><br>&lt;details&gt;<br>  &lt;summary&gt;Check out discussions&lt;/summary&gt;<br><br>- [#290](<https://github.com/puppeteer/puppeteer/issues/290>) - Debian troubleshooting &lt;br/&gt;<br>- [#391](<https://github.com/puppeteer/puppeteer/issues/391>) - CentOS troubleshooting &lt;br/&gt;<br>- [#379](<https://github.com/puppeteer/puppeteer/issues/379>) - Alpine troubleshooting &lt;br/&gt;<br>&lt;/details&gt;<br><br>## Chrome is downloaded but fails to launch on Node.js 14<br><br>If you get an error that looks like this when trying to launch Chromium:<br></pre><br>(node:15505) UnhandledPromiseRejectionWarning: Error: Failed to launch the browser process!<br>spawn /Users/.../node_modules/puppeteer/.local-chromium/mac-756035/chrome-mac/Chromium.app/Contents/MacOS/Chromium ENOENT<br><pre><br>This means that the browser was downloaded but failed to be extracted correctly. The most common cause is a bug in Node.js v14.0.0 which broke `extract-zip`, the module Puppeteer uses to extract browser downloads into the right place. The bug was fixed in Node.js v14.1.0, so please make sure you're running that version or higher. Alternatively, if you cannot upgrade, you could downgrade to Node.js v12, but we recommend upgrading when possible.<br><br><br>## Setting Up Chrome Linux Sandbox<br><br>In order to protect the host environment from untrusted web content, Chrome uses [multiple layers of sandboxing](<https://chromium.googlesource.com/chromium/src/+/HEAD/docs/linux/sandboxing.md>). For this to work properly,<br>the host should be configured first. If there's no good sandbox for Chrome to use, it will crash<br>with the error `No usable sandbox!`.<br><br>If you **absolutely trust** the content you open in Chrome, you can launch Chrome<br>with the `--no-sandbox` argument:<br></pre>js<br>const browser = await puppeteer.launch({args: ['--no-sandbox', '--disable-setuid-sandbox']});<br><pre><br><blockquote>**NOTE**: Running without a sandbox is **strongly discouraged**. Consider configuring a sandbox instead.</blockquote>There are 2 ways to configure a sandbox in Chromium.<br><br>### [recommended] Enable [user namespace cloning](<http://man7.org/linux/man-pages/man7/user_namespaces.7.html>)<br><br>User namespace cloning is only supported by modern kernels. Unprivileged user namespaces are generally fine to enable,<br>but in some cases they open up more kernel attack surface for (unsandboxed) non-root processes to elevate to<br>kernel privileges.<br></pre>bash<br>sudo sysctl -w kernel.unprivileged_userns_clone=1<br><pre><br>### [alternative] Setup [setuid sandbox](<https://chromium.googlesource.com/chromium/src/+/HEAD/docs/linux/suid_sandbox_development.md>)<br><br>The setuid sandbox comes as a standalone executable and is located next to the Chromium that Puppeteer downloads. It is<br>fine to re-use the same sandbox executable for different Chromium versions, so the following could be<br>done only once per host environment:<br></pre>bash<br># cd to the downloaded instance<br>cd &lt;project-dir-path&gt;/node_modules/puppeteer/.local-chromium/linux-&lt;revision&gt;/chrome-linux/<br>sudo chown root:root chrome_sandbox<br>sudo chmod 4755 chrome_sandbox<br># copy sandbox executable to a shared location<br>sudo cp -p chrome_sandbox /usr/local/sbin/chrome-devel-sandbox<br># export CHROME_DEVEL_SANDBOX env variable<br>export CHROME_DEVEL_SANDBOX=/usr/local/sbin/chrome-devel-sandbox<br><pre><br>You might want to export the `CHROME_DEVEL_SANDBOX` env variable by default. In this case, add the following to the `~/.bashrc`<br>or `.zshenv`:<br></pre>bash<br>export CHROME_DEVEL_SANDBOX=/usr/local/sbin/chrome-devel-sandbox<br><pre><br><br>## Running Puppeteer on Travis CI<br><br><blockquote>👋 We run our tests for Puppeteer on Travis CI - see our [`.travis.yml`](<https://github.com/puppeteer/puppeteer/blob/main/.travis.yml>) for reference.</blockquote>Tips-n-tricks:<br>- [xvfb](<https://en.wikipedia.org/wiki/Xvfb>) service should be launched in order to run Chromium in non-headless mode<br>- Runs on Xenial Linux on Travis by default<br>- Runs `npm install` by default<br>- `node_modules` is cached by default<br><br>`.travis.yml` might look like this:<br></pre>yml<br>language: node_js<br>node_js: node<br>services: xvfb<br><br>script:<br>  - npm run test<br>```<br><br>## Running Puppeteer on CircleCI<br><br>Running Puppeteer smoothly on CircleCI requires the following steps:<br><br>1. Start with a [NodeJS<br>   image](<https://circleci.com/docs/2.0/circleci-images/#nodejs>) in your config<br>   like so:<br>   ```yaml<br>   docker:<br>     - image: circleci/node:12 # Use your desired version<br>       environment:<br>         NODE_ENV: development # Only needed if puppeteer is in `devDependencies`<br>   ```<br>1. Dependencies like `libXtst6` probably need to be installed via `apt-get`,<br>   so use the<br>   [threetreeslight/puppeteer](<https://circleci.com/orbs/registry/orb/threetreeslight/puppeteer>)<br>   orb<br>   ([instructions](<https://circleci.com/orbs/registry/orb/threetreeslight/puppeteer#quick-start>)),<br>   or paste parts of its<br>   [source](<https://circleci.com/orbs/registry/orb/threetreeslight/puppeteer…</blockquote>|
|10:54|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|Create Book crashes when .gitconfig exists but user is not set:<br><blockquote><https://github.com/vivliostyle/create-book/issues/15><br><https://github.com/uetchy/create-create-app/pull/26></blockquote>|
