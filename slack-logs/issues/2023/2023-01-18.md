# 2023-01-18

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|11:13|![](https://secure.gravatar.com/avatar/6a1342affe7c337c61db338b633abef3.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png)|lwohtsu|`@shinyu`<br>お疲れ様です。最新版（@vivliostyle/cli@6.1.0）のPDF出力でトラブルが出るようです（Win11環境）。<br><br>1. とある仕事でA5版の仮組み（判型と文字サイズ指定程度のかなりシンプルなもの）を作ろうとしたところ、なぜかA4サイズの左上にA5版が配置されたような状態で出力されました（vs6.1.0-a.png）。画像はChromiumの印刷プレビューですが、「vivliostyle build」でも同じ結果になります。<br>2. CSS組版本のサンプル（sample1.mdやsample1.html、A5版）で試したところ、「vivliostyle build」だとエラー終了してPDFが作れませんでした（vs6.1.0-b.png）。また、Chromiumの印刷プレビューを使おうとすると「out of memory」になります（vs6.1.0-c.png）。<br>3. CSS組版本自体はなぜか問題なくPDFが書き出せました（vs6.1.0-d.png）。これはA5版ですが、背景画像の都合で四方3mmずつ広げた154×216mmという変則サイズです。CSSが一番複雑なので、むしろ失敗しそうな気もするのですが……。<br>https://vivliostyle.slack.com/files/UJ1U19SU9/F04KGQZ4NRJ/vs6.1.0-a.png<br>https://vivliostyle.slack.com/files/UJ1U19SU9/F04KE7TCE11/vs6.1.0-b.png<br>https://vivliostyle.slack.com/files/UJ1U19SU9/F04KT0K2F7T/vs6.1.0-c.png<br>https://vivliostyle.slack.com/files/UJ1U19SU9/F04KT1T56MP/vs6.1.0-d.png|
|11:13|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇺🇸: `@shinyu`<br>thank you for your hard work. There seems to be a problem with PDF output of the latest version (@vivliostyle/cli@6.1.0) (Win11 environment).<br><br>1. When I tried to create a temporary layout of A5 size (a fairly simple one with a format and character size specified) for a certain job, for some reason it was output as if the A5 size was placed on the upper left of the A4 size. (vs6.1.0-a.png). The image is a Chromium print preview, but the "vivliostyle build" gives the same result.<br>2. When I tried with CSS typesetting book samples (sample1.md, sample1.html, A5 version), "vivliostyle build" ended with an error and could not create PDF (vs6.1.0-b.png). I also get "out of memory" when trying to use Chromium's print preview (vs6.1.0-c.png).<br>3. For some reason, the CSS typesetting book itself could be exported to PDF without any problems (vs6.1.0-d.png). This is an A5 version, but for the convenience of the background image, it is an irregular size of 154 x 216 mm, which is expanded by 3 mm on each side. CSS is the most complicated, so I feel like I'm going to fail, but...|
|13:44|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|2はこちらで再現しました(WinとMacのどちらでも)。極細ボーダーを可能にしたことで問題が起きてました。<br><https://github.com/vivliostyle/vivliostyle.js/pull/1079><br>プレビューでは、URLに `&amp;pixelRatio=4` （デフォルトは8としているのを4に下げる）を追加すると、ブラウザからの印刷ができるようになりました。（buildコマンドからはこのパラメータを指定することはできません）　どうしてこのサンプルでこの問題が起きるのか調べます。<br><br>1について、テストしたいのでサンプルをください。<br><blockquote>Enables very thin border width by emulating high pixel ratio.<br><br>• fixes <https://github.com/vivliostyle/vivliostyle.js/issues/419|#419><br>• also improves on <https://github.com/vivliostyle/vivliostyle.js/issues/1076|#1076><br><br>*About `pixelRatio` viewer option*<br><br>The output pixel ratio is configurable by setting `pixelRatio=<number>` in <https://github.com/vivliostyle/vivliostyle.js/blob/master/packages/viewer/src/models/viewer-options.ts|Vivliostyle Viewer options>, or in the <https://github.com/vivliostyle/vivliostyle.js/blob/master/packages/core/src/vivliostyle/core-viewer.ts#L73|CoreViewerOptions>. The default setting is `pixelRatio=8`, which means that the minimum border width is 1/8 px = 0.125px (about 0.09pt, or 0.033mm).<br><br>The pixelRatio value can be any number (max value is 16 -- updated in <https://github.com/vivliostyle/vivliostyle.js/pull/1085|#1085>) but recommended values are 1, 2, 4, *8* (default), or 16. Note:<br><br>• Values other than powers of 2 may cause layout problems.<br>• Large value may cause problem in browser.<br>• If 0 is specified, the pixel ratio emulation is turned off. Note that this is not same as `pixelRatio=1` when your display device pixel ratio is not 1, i.e., with HiDPI display such as "Retina" display whose device pixel ratio is 2.<br><br>*Limitation*<br><br>This high pixel ratio emulation on PDF output works only with Chromium (Chrome) browser (except Microsoft Edge -- updated in <https://github.com/vivliostyle/vivliostyle.js/pull/1085|#1085>), because it uses the `zoom` non-standard CSS property that Firefox does not support and negative page margins in the page rule that both Firefox and Safari do not support.</blockquote>|
|13:44|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇺🇸: 2 was reproduced here (on both Win and Mac). There was a problem with enabling ultra-thin borders.<br><https://github.com/vivliostyle/vivliostyle.js/pull/1079><br>In the preview, adding `&amp;pixelRatio=4` to the URL (lowering the default of 8 to 4) enabled printing from the browser. (This parameter cannot be specified from the build command) Investigate why this problem occurs in this sample.<br><br>Regarding 1, I would like to test it, so please give me a sample.|
|15:19|![](https://secure.gravatar.com/avatar/6a1342affe7c337c61db338b633abef3.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png)|lwohtsu|お疲れ様です。お手数おかけします。<br>1の原稿は著者さんからの預かり物なので、CSSのみお送りします。<br><br>原稿をお送りできないので今追加で調べてみたのですが、原稿によって症状が出るものと出ないものがあり、違いを探したところ、どうも*コード（バッククォート3つで生成するpre、code）が要素端で折り返されず、版面からはみ出したとき*に現象が出るようです。<br>雑な仮組み用に短時間で作ったものなので、「white-space: pre-wrap;」などを入れていませんでした。<br><br>ひとまずpreに対して「white-space: pre-wrap;」を入れると、1の症状は解決できた（A5で出力される）のですが、それでよいのかどうかは難しいところです。<br>https://vivliostyle.slack.com/files/UJ1U19SU9/F04KFE0N03V/main.css|
|15:19|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇺🇸: thank you for your hard work. I'm sorry for troubling you.<br>Since the manuscript of 1 was entrusted by the author, I will only send CSS.<br><br>I can't send the manuscript, so I've been looking into it now, but some manuscripts have symptoms and others don't. It seems that the phenomenon occurs* when it is not wrapped at the edge of the element and it protrudes from the printing surface.<br>I didn't put "white-space: pre-wrap;" because it was made in a short time for rough temporary assembly.<br><br>For the time being, if you put "white-space: pre-wrap;" for pre, the symptom 1 could be solved (output in A5), but it is difficult to say whether it is good.|
|15:20|![](https://secure.gravatar.com/avatar/6a1342affe7c337c61db338b633abef3.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0024-72.png)|lwohtsu|×版面からはみ出した<br>○判型（用紙）からはみ出した|
|15:20|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇺🇸: × Protruding from the plate<br>○ Protruded from the format (paper)|
|15:53|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|2のChromiumからの印刷がクラッシュする問題は、とても単純なHTML+CSSで発生するのが分かり、issueにしました:<br><https://github.com/vivliostyle/vivliostyle.js/issues/1095><br><blockquote>*Describe the bug*<br><br>The following simple HTML+CSS crashes printing from Vivliostyle Viewer (or CLI).<br><br><pre><style><br>  @page {<br>    size: a5;<br>  }<br>  h1 {<br>    margin-top: 40mm;<br>  }<br></style><br><h1>Hello</h1></pre><br><br>*To Reproduce*  <br>Steps to reproduce the behavior:<br><br>1. Go to <https://vivliostyle.org/viewer/#src=data:,%3Ch1%3EHello%3C/h1%3E&style=data:,/*%3Cviewer%3E*/%0A@page%20%7B%20size:%20a5;%20%7D%0A/*%3C/viewer%3E*/%0Ah1%20%7B%0A%20%20margin-top:%2040mm;%0A%7D|https://vivliostyle.org/viewer/#src=data:,%3Ch1%3EHello%3C/h1%3E&style=data:,/*%3Cviewer%3E*/%0A@page%20%7B%20size:%20a5;%20%7D%0A/*%3C/viewer%3E*/%0Ah1%20%7B%0A%20%20margin-top:%2040mm;%0A%7D><br>2. Click the Print button<br>3. waiting the print preview ...<br>4. See error<br><br>*Screenshots*  <br><https://user-images.githubusercontent.com/3324737/213217877-957da77f-04e1-4df3-a411-82f2904a0336.png|Screenshot 2023-01-19 at 0 27 49><br><br>This problem does not happen with the previous version v2.20.0:  <br><https://vivliostyle.github.io/viewer/v2.20.0/#src=data:,%3Ch1%3EHello%3C/h1%3E&style=data:,/*%3Cviewer%3E*/%0A@page%20%7B%20size:%20a5;%20%7D%0A/*%3C/viewer%3E*/%0Ah1%20%7B%0A%20%20margin-top:%2040mm;%0A%7D|https://vivliostyle.github.io/viewer/v2.20.0/#src=data:,%3Ch1%3EHello%3C/h1%3E&style=data:,/*%3Cviewer%3E*/%0A@page%20%7B%20size:%20a5;%20%7D%0A/*%3C/viewer%3E*/%0Ah1%20%7B%0A%20%20margin-top:%2040mm;%0A%7D></blockquote>|
|15:53|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇺🇸: The problem of crashing printing from Chromium in 2 was found to occur with very simple HTML + CSS, so I made an issue:<br><https://github.com/vivliostyle/vivliostyle.js/issues/1095>|
|16:08|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|1の問題は、ページから横にオーバーフローするとChromiumは印刷のとき横にはみ出しているものを全部収めようとして、その結果縮小されて印刷されることが原因です。横にはみ出している部分は bleed box での overflow: hidden により印刷されないのですが、それでもこの問題が起きます。これもあとでissueにして、Vivliostyle.jsで対策できないか今後の課題とします。|
|16:08|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇺🇸: Problem 1 is that when you overflow the page horizontally, Chromium will try to fit everything that is overhanging when printing, resulting in a shrunk print. The overflow: hidden on the bleed box prevents it from printing, but the problem still occurs. This will also be an issue later, and it will be a future issue to see if Vivliostyle.js can be used as a countermeasure.|
