# 2022-05-18

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|02:31|![](https://secure.gravatar.com/avatar/071ca54af656223d6d39098e0598e777.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0022-72.png)|藤井太洋|ミートアップの時に報告した遅い問題ですが、ついにGitHub Actionsで動かないほど遅くなる状態を再現しました。<br><br><https://github.com/vivliostyle/vivliostyle-cli/issues/285><br><blockquote>When 500 pages document processed on GitHub Actions instance, vivliostyle-cli crashes.  <br>Reproduce repository is following.  <br><https://github.com/ttrace/autobuild/runs/6481383049?check_suite_focus=true|https://github.com/ttrace/autobuild/runs/6481383049?check_suite_focus=true><br><br>Reproduction process<br><br>1. Clone repository<br>2. Add tag galley-[unique token]<br>3. GitHub Actions starts to produce PDF<br>4. vivliostyle-cli crashes with following error.<br><br>However project set -t as 600 seconds, but vivliostyle-cli returns timeout error as 30000ms (as error message).<br><br>Basically, the processing of vivliostyle-cli is further slower than expected.  <br>When the same html is processed with preview argument, user will see the first page in 10 seconds on Chromium and the processing time of saving whole pages in PDF is 30 seconds. But cli spends 10 minutes or longer.<br><br><pre>Run npx vivliostyle build -t 600 publish/buildHtml.html -o publish/refs/tags/galley-TEST.pdf<br>[4](<https://github.com/ttrace/Second-Opening/runs/6480736064?check_suite_focus=true#step:11:5>)<br>- Collecting build config<br>[5](<https://github.com/ttrace/Second-Opening/runs/6480736064?check_suite_focus=true#step:11:6>)<br>- Building PDF<br>[6](<https://github.com/ttrace/Second-Opening/runs/6480736064?check_suite_focus=true#step:11:7>)<br>TimeoutError: waiting for Page.printToPDF failed: timeout 30000ms exceeded<br>[7](<https://github.com/ttrace/Second-Opening/runs/6480736064?check_suite_focus=true#step:11:8>)<br><br>[8](<https://github.com/ttrace/Second-Opening/runs/6480736064?check_suite_focus=true#step:11:9>)<br>    at Object.waitWithTimeout (/Users/runner/work/Second-Opening/Second-Opening/node_modules/puppeteer-core/lib/cjs/puppeteer/common/helper.js:224:26)<br>[9](<https://github.com/ttrace/Second-Opening/runs/6480736064?check_suite_focus=true#step:11:10>)<br>If you think this is a bug, please report at <https://github.com/vivliostyle/vivliostyle-cli/issues><br>[10](<https://github.com/ttrace/Second-Opening/runs/6480736064?check_suite_focus=true#step:11:11>)<br>    at Page.createPDFStream (/Users/runner/work/Second-Opening/Second-Opening/node_modules/puppeteer-core/lib/cjs/puppeteer/common/Page.js:2091:49)<br>[11](<https://github.com/ttrace/Second-Opening/runs/6480736064?check_suite_focus=true#step:11:12>)<br>    at Page.pdf (/Users/runner/work/Second-Opening/Second-Opening/node_modules/puppeteer-core/lib/cjs/puppeteer/common/Page.js:2103:37)<br>[12](<https://github.com/ttrace/Second-Opening/runs/6480736064?check_suite_focus=true#step:11:13>)<br>    at Object.buildPDF (/Users/runner/work/Second-Opening/Second-Opening/node_modules/@vivliostyle/cli/dist/pdf.js:171:28)<br>[13](<https://github.com/ttrace/Second-Opening/runs/6480736064?check_suite_focus=true#step:11:14>)<br>    at runMicrotasks (&lt;anonymous&gt;)<br>[14](<https://github.com/ttrace/Second-Opening/runs/6480736064?check_suite_focus=true#step:11:15>)<br>    at processTicksAndRejections (internal/process/task_queues.js:97:5)<br>[15](<https://github.com/ttrace/Second-Opening/runs/6480736064?check_suite_focus=true#step:11:16>)<br>    at async build (/Users/runner/work/Second-Opening/Second-Opening/node_modules/@vivliostyle/cli/dist/commands/build.js:93:26)<br>[16](<https://github.com/ttrace/Second-Opening/runs/6480736064?check_suite_focus=true#step:11:17>)<br>Error: Process completed with exit code 1.<br></pre></blockquote>|
|02:31|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: It's a slow issue I reported at the time of the meetup, but finally<br><https://github.com/vivliostyle/vivliostyle-cli/issues/285>|
|02:52|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|使われているVivliostyle CLI 4.5.0ではPDF出力のtimeoutが30秒に固定されていた不具合がありました<br><https://github.com/vivliostyle/vivliostyle-cli/issues/230><br><br>最新版では修正されているはずなのでご確認おねがします！<br><blockquote>Hi,<br><br>I saw the following error when trying to convert a larget document to PDF with vivliostyle-cli:<br><br><pre>✖ TimeoutError: waiting for Page.printToPDF failed: timeout 30000ms exceeded<br>    at Object.waitWithTimeout (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/puppeteer-core/lib/cjs/puppeteer/common/helper.js:224:26)<br>    at Page.createPDFStream (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/puppeteer-core/lib/cjs/puppeteer/common/Page.js:2091:49)<br>    at Page.pdf (/usr/local/lib/node_modules/@vivliostyle/cli/node_modules/puppeteer-core/lib/cjs/puppeteer/common/Page.js:2103:37)<br>    !!!at Object.buildPDF (/usr/local/lib/node_modules/@vivliostyle/cli/dist/pdf.js:171:28)<br>    at processTicksAndRejections (node:internal/process/task_queues:96:5)<br>    at async build (/usr/local/lib/node_modules/@vivliostyle/cli/dist/commands/build.js:93:26)<br></pre><br><br>Setting a timeout through `-t` flag doesn't work because in `Object.buildPDF`, the timeout value isn't passed to the `Page.pdf` function:  <br><br><https://github.com/vivliostyle/vivliostyle-cli/blob/66cd1ace93a823e9d5203f02bf3841786bd6de52/src/pdf.ts#L241-L250|vivliostyle-cli/src/pdf.ts><br><br>Lines 241 to 250 in &lt;/vivliostyle/vivliostyle-cli/commit/66cd1ace93a823e9d5203f02bf3841786bd6de52|66cd1ac&gt;<br><br>So the timeout of `Page.pdf` is always 30 seconds (the default). I suggest to at least use the same timeout value for `Page.pdf`, so that the wait timeout of create PDF is configurable.<br><br>Thank you!</blockquote>|
|02:52|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: In the Vivliostyle CLI 4.5.0 used, there was a problem that the timeout of PDF output was fixed to 30 seconds.<br><https://github.com/vivliostyle/vivliostyle-cli/issues/230><br><br>It should have been fixed in the latest version, so please check it!|
|02:57|![](https://secure.gravatar.com/avatar/071ca54af656223d6d39098e0598e777.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0022-72.png)|藤井太洋|ありがとうございます。とりあえずクラッシュせずに動きました。<br><br>ただ、同じドキュメントを3.5系列やpreviewで処理すると50倍ぐらい早いんです。もうちょっと早くなると使いやすくなるなあと思うことが多いです。|
|02:58|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: Thank you very much. For the time being, it worked without crashing.<br><br>However, processing the same document with 3.5 series or preview is about 50 times faster. I often think that it will be easier to use if it gets a little faster.|
