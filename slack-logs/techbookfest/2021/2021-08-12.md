# 2021-08-12

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|02:00|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|本文の１行が脚注の下に配置されるなどの不具合が起きるのは、Chromeからの印刷で日本語のカナ文字のカーニングが効かない（画面表示ではデフォルトでカーニングが有効なのに）ために、ページを印刷するときページの版面に画面表示時には収まっていた文字が収まらず、オーバーフローしてしまう（そのため脚注があるときは脚注の下に配置される）という問題であることが分かりました。<br><br>組版のプレビューと印刷（PDF出力）とで結果が変わってレイアウトが崩れてしまうという困った問題です。<br>Chromeブラウザが修正されるまでは、`font-kerning: none` を指定するなどで対処する必要があります。<br><br>Issue登録しました:<br><https://github.com/vivliostyle/vivliostyle.js/issues/758><br><blockquote>Vivliostyle Viewerでの画面表示では正常に組版できていても、Chromeブラウザからの印刷で、日本語の行の折り返し位置が変わってページの最後の行が版面に入り切らずオーバーフローしてしまうことがあります。<br><br>macOS上のChromeブラウザでこの問題が発生します。<br><br><https://vivliostyle.org/ja/samples/|サンプルページ> で公開の以下のサンプルで再現します：<br><br>サンプル1　  <br>「Vivliostyleで本を作ろうVol.5」  <br><https://vivliostyle.org/viewer/#src=https://vivliostyle.github.io/vivliostyle_doc/ja/vivliostyle-user-group-vol5/content/&amp;bookMode=true|https://vivliostyle.org/viewer/#src=https://vivliostyle.github.io/vivliostyle_doc/ja/vivliostyle-user-group-vol5/content/&amp;bookMode=true><br><br>スクリーンショット  <br><https://user-images.githubusercontent.com/3324737/129048934-6eb5358e-17ce-41d4-bd92-88039e5ddb82.png|Screen Shot 2021-08-10 at 23 31 36><br><br>サンプル2  <br>「宇宙論」  <br><https://vivliostyle.org/viewer/#src=https://jagat-xpub.github.io/cosmology/&amp;userStyle=data:,/*%3Cviewer%3E*/%0A@page%20%7B%20size:%20a5;%20%7D%0A/*%3C/viewer%3E*/|https://vivliostyle.org/viewer/#src=https://jagat-xpub.github.io/cosmology/&amp;userStyle=data:,/*%3Cviewer%3E*/%0A@page%20%7B%20size:%20a5;%20%7D%0A/*%3C/viewer%3E*/><br><br>スクリーンショット  <br><https://user-images.githubusercontent.com/3324737/129049370-883a8b52-737c-48d6-96a7-c29f74b1272c.png|Screen Shot 2021-08-03 at 13 48 46><br><br>*原因*<br><br>原因は、Chromeブラウザの問題で、印刷のときだけ日本語テキスト（平仮名・片仮名）のペアカーニングが効かないためであることが判明。<br><br>テストJSBin: <https://jsbin.com/vapulog/edit?html,css,output|https://jsbin.com/vapulog/edit?html,css,output><br><br>スクリーンショット  <br><https://user-images.githubusercontent.com/3324737/129049707-d81fb70a-c3f4-4920-97f1-8d43a222b878.png|Screen Shot 2021-08-11 at 22 58 30><br><br>このスクリーンショットの左側はChromeブラウザの通常表示、右側は印刷プレビュー表示。  <br>通常表示では、カーニングOFFの1行目とカーニングONの2行目で日本語のテキストが違う（カーニングにより文字間が詰まる）。  <br>しかし、印刷プレビュー表示では2行目でカーニングが効いていないようで、1行目と同じテキスト幅になる。  <br>英字のカーニングについては、通常表示でも印刷プレビュー表示でも同じ結果になる。<br><br>Vivliostyleの組版処理ではブラウザの通常表示でのテキスト幅を使って改行・改ページの位置を決定している。印刷のときにそのテキスト幅が変わってしまうと通常表示ではページ内に収まっていたテキストがページに収まらなくなり組版結果が崩れることになる。</blockquote>|
