# 2023-03-10

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|02:33|![](https://avatars.slack-edge.com/2019-11-22/845042642576_070441337abaca9fb7b3_72.png)|ogwata|`@shinyu`<br><br>ただ今、vivliostyle-viewer.md の改訂中です。質問です。<br><https://vivliostyle.github.io/vivliostyle_doc/ja/vivliostyle-user-group-vol1/shinyu/index.html#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%AB%E8%A8%AD%E5%AE%9A%EF%BC%88user-style-preferences%EF%BC%89|https://vivliostyle.github.io/vivliostyle_doc/ja/vivliostyle-user-group-vol1/shinyu/index.html#%E3%83%A6%E3%83%BC%E3%82%[…]tyle-preferences%EF%BC%89><br><br>上記のうち「Text（テキスト）」で、「Vivliostyle の文字サイズの基本設定」とあるのは、Vivliostyle.jsのデフォルトスタイルシートにおける`font-size`という意味でしょうか？|
|02:52|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|デフォルトスタイルシートに本文のfont-sizeの設定はありません。CSSでのfont-sizeの初期値は `medium` その実際の値はブラウザの標準では 16px です。Vivliostyleでも16pxをデフォルトにしてます。|
|03:09|![](https://avatars.slack-edge.com/2019-11-22/845042642576_070441337abaca9fb7b3_72.png)|ogwata|原文<br><blockquote>指定しない場合のデフォルトはブラウザと同じ`line-height: normal`で、行の高さは使われるフォントに依存します。</blockquote>この部分、仕様ではUA依存だと思いますが、あえて「フォントに依存」にした理由はなんでしょう？　これだとフォントを変更すると行の高さも変わるように受け取れます。|
|03:19|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|line-heightの最新の仕様は<br><https://drafts.csswg.org/css-inline/#line-height-property><br>で、UA依存ではなくなってます。|
|03:20|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|*normal*<br>Determine the <https://drafts.csswg.org/css-inline/#preferred-line-height|preferred line height> automatically based on font metrics.|
|03:21|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|この仕様にあるline-height:normalが、実際の現在のブラウザに実装されているものです。|
|03:21|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|フォントに依存するようになってます。|
|03:28|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|CSS Inline Layout Moduleは、まだWorking Draftの段階（公式のCSSの定義には含まれない）なので、CSS2でのUA依存という定義がMDNなどに書かれているということです。<br>（MDNの記述でも、「`font-family` によって決まる」とあることに注意）<br><https://developer.mozilla.org/ja/docs/Web/CSS/line-height><br><blockquote>line-height は CSS のプロパティで、行ボックスの高さを設定します。これは主にテキストの行間を設定するために使用します。ブロックレベル要素では、要素に含まれる行ボックスの最小の高さを指定します。非置換インライン要素では、行ボックスの高さの計算に使われる高さを指定します。</blockquote>|
|03:55|![](https://avatars.slack-edge.com/2019-11-22/845042642576_070441337abaca9fb7b3_72.png)|ogwata|そうだったんですね。ありがとうございます。<br><br>ところで、どうしてUA依存からフォント依存に変更されたのでしょう？|
|03:57|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|ブラウザでのデフォルトのline-heightの挙動が標準化されていない状態が問題になったためです。|
|04:02|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|<https://github.com/w3c/csswg-drafts/issues/254><br><blockquote><http://meyerweb.com/eric/thoughts/2008/05/06/line-height-abnormal/|http://meyerweb.com/eric/thoughts/2008/05/06/line-height-abnormal/><br><br>(Comments on what 'line-height: normal' means in various browsers welcome.)</blockquote>|
|08:53|![](https://avatars.slack-edge.com/2019-11-22/845042642576_070441337abaca9fb7b3_72.png)|ogwata|`@shinyu`<br>まとめて質問です。<br><br>• Page Spread View &gt; Auto あらかじめ設定された何かの値に従うことと思えるが、それは何？<br>• *Crop Marks &gt;* Bleed を指定しない場合のデフォルト値は？<br>• *Crop Marks &gt;* Crop offset  を指定しない場合のデフォルト値は？<br>• *Custom Style Prioritにおける、“*Set as user stylesheet” と　“Force override document style” の違いは？|
|09:06|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|自動見開き（Page Spread View &gt; Auto ）は、ウインドウが横長で見開き2ページが表示できれば見開き表示にするというものです。|
|09:19|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|<blockquote>• *Crop Marks &gt;* Bleed を指定しない場合のデフォルト値は？</blockquote>Crop marksにチェックを入れるとBleedのチェックも入るようになってます。このBleedのチェックを外した場合 bleed の指定がなしになるのでCSSでのbleedプロパティの初期値となります。その値は `auto` であり、その定義は：<br><br><https://www.w3.org/TR/css-page-3/#bleed><br><br>*auto*<br>Computes to 6pt if <https://www.w3.org/TR/css-page-3/#descdef-page-marks|marks> has <https://www.w3.org/TR/css-page-3/#valdef-page-marks-crop|crop> and to zero otherwise.<br>（Crop markありならば 6pt で、なしならば 0）<br><br>つまりCSS Pagedメディア仕様でトンボありの場合のbleedのデフォルトは 6pt (約2.1mm) です。<br>このデフォルトのままではあまり適切でない場合が多そうなので、Crop marksにチェックを入れると  bleed: 3mm も指定されるようにしたということです。|
|09:26|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|<blockquote>• *Crop Marks &gt;* Crop offset  を指定しない場合のデフォルト値は？</blockquote>Vivliostyle の crop-offset プロパティの仕様は<br><https://github.com/vivliostyle/vivliostyle.js/issues/913><br>にあります。<br><br><blockquote>The initial value `auto` will be same as the current behavior, i.e., 13mm + bleed size when marks are specified otherwise same as bleed size.</blockquote>トンボの指定がある場合、13mm + bleed size です。bleed:3mm の場合、16mm ということです。<br><blockquote>Vivliostyle supports the <https://drafts.csswg.org/css-page-3/#marks|marks> and <https://drafts.csswg.org/css-page-3/#bleed|bleed> properties to generate page layout with crop marks. When this feature is used, the output page size (the MediaBox size in output PDF) becomes larger than the original page size (trim size).<br><br>The crop-offset setting (the distance between the edge of the trim size and the edge of the output page media size) is not yet standardized in the CSS-page spec, and Vivliostyle uses currently always 13mm + bleed size. It would be useful to be able to change this setting.<br><br>Antenna House Formatter has `-ah-crop-offset` property: <https://www.antenna.co.jp/AHF/help/en/ahf-ext.html#axf.crop-offset|https://www.antenna.co.jp/AHF/help/en/ahf-ext.html#axf.crop-offset><br><br>For Vivliostyle, a simple `crop-offset` property that sets single crop offset value for all sides will be sufficient in most cases.<br><br><pre>Name:    crop-offset<br>For:     @page<br>Value:   auto | <length><br>Initial: auto</pre><br><br>The initial value `auto` will be same as the current behavior, i.e., 13mm + bleed size when marks are specified otherwise same as bleed size.<br><br>Example:<br><br><pre>@page {<br>  size: 148mm 210mm;<br>  marks: crop cross;<br>  bleed: 3mm;<br>  crop-offset: 9mm;<br>}</pre></blockquote>|
|09:34|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|• *Custom Style Priorityにおける、“*Set as user stylesheet” と　“Force override document style” の違いは？<br>*“*Set as user stylesheet” はカスタムスタイル設定をユーザースタイルシートとして設定します。デフォルトでは作成者スタイルシートです。これらの違いは<br><https://developer.mozilla.org/ja/docs/Web/CSS/Cascade><br><blockquote>カスケードは、異なるソースから来るプロパティ値を組み合わせる方法を定義するアルゴリズムです。カスケードでは、複数のオリジンやカスケードレイヤーの宣言が要素のプロパティに値を設定する場合に、何が優先されるかを定義します。</blockquote>|
|09:37|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|“Force override document style” は、スタイルの設定に !important をつけます。<br>これにより、強制的に文書のスタイルを上書きすることになります。|
|09:51|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|現在のカスタムスタイル設定に変える前は、常にユーザースタイルシートとして設定してました。その場合、文書にあるスタイルよりもユーザースタイルの重要度は低いので、そのままでは上書きできず、上書きするには !important の指定が必要でした。<br><br>現在は文書にあるスタイルと同じ作成者スタイルシート扱いがデフォルトなので、!important 指定なしでも上書きできます。たとえば `@page { size: A4; }` と文書に指定されている場合、カスタムスタイル設定でページサイズを A5 にすると、A5 に上書きされます。<br>しかし、文書での指定が `@page { size: A4 !important; }` のように!important付きだったら、それを上書きするにはカスタムスタイル設定でも !important ありにする（“Force override document style” をチェックする）必要があります。|
|10:19|![](https://avatars.slack-edge.com/2019-11-22/845042642576_070441337abaca9fb7b3_72.png)|ogwata|連続の質問で申し訳ないです。<br>以下の項目は、プリセットで指定した用紙サイズの横2倍に表示する設定と思いますが、どういう用途を想定しているのでしょう？<br>• Custom Style Settings &gt; *Page Size &gt;* Preset &gt; Landscape|
|10:25|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|Landscape は用紙サイズの横2倍ではなくて、 横置きのサイズにするというものです。<br><br>A4 サイズは width: 210mm, height: 297mm ですが、landscape を指定すると width: 297mm, height: 210mm になります。|
|10:26|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|仕様<br><https://www.w3.org/TR/css-page-3/#page-size-prop>|
|10:28|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|設定項目での設定でどのようなCSSになるのか、Edit CSSのボックスの内容で確認するとよいです。|
|10:28|![](https://avatars.slack-edge.com/2019-11-22/845042642576_070441337abaca9fb7b3_72.png)|ogwata|たびたびすみません。<br>以下は「特に指定がない限りAuto」と注記されていますが、この「Auto」とは具体的になんでしょう。次のメニュー項目が「Auto」ですが、これとは違いますね？<br><br>• Custom Style Settings &gt; *Page Size &gt;* Auto|
|10:34|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|`@page { size: auto; }`<br><br>sizeのデフォルトはautoです。<br><br>仕様<br><https://www.w3.org/TR/css-page-3/#valdef-page-size-auto><br>*auto*<br>The page box will be set to a size and orientation chosen by the UA. In the usual case, the page box size and orientation is chosen to match the target media sheet.<br><br>この場合Vivliostyleはウインドウサイズを使います。<br><br>もし文書に size: A4 の指定があって、この設定で Auto を指定した場合、A4ではなくてウインドウサイズになります。<br><br>設定のデフォルトの「特に指定がない限りAuto」というのは、文書のスタイルシートに size の指定がなければCSSのデフォルトである auto になるという意味です。文書にsizeの指定があれば当然それが有効になります。|
|13:37|![](https://avatars.slack-edge.com/2019-11-22/845042642576_070441337abaca9fb7b3_72.png)|ogwata|<blockquote>文書のスタイルシートに size の指定がなければCSSのデフォルトである auto になるという意味です。</blockquote>CSS Paged Media では以下のように規定しています。<br><br><blockquote>auto<br>    The page box will be set to a size and orientation chosen by the UA. In the usual case, the page box size and orientation is chosen to match the target media sheet. </blockquote>Vivliostyle Viewerの場合、上記の「UA」とはVivliostyle.jsのデフォルトスタイルシートの指定値、≒A4ということでしょうか？<br><br><https://github.com/vivliostyle/vivliostyle-cli/issues/250#issuecomment-1038630656><br>（width: 794px、height: 1056px）<br><blockquote>ブラウザのウインドウサイズが利用できない場合のページサイズautoの問題は、Vivliostyle CLIだけの問題ではないので、Vivliostyle.js側で対処することにしました。<br><br>• <https://github.com/vivliostyle/vivliostyle.js/pull/876|vivliostyle/vivliostyle.js#876><br><br>> When page size is not specified or `auto`, Vivliostyle uses the window size to determine the page size.  <br>> The problem here is when the window size is not available, i.e., window size is 0 or browser is in headless mode.<br>> <br>> To solve the problem, now we use the fallbackPageSize:<br>> <br>> ```<br>>     const fallbackPageSize = {<br>>       // compromise between A4 (210mm 297mm) and letter (8.5in 11in)<br>>       width: 794, // 210mm (8.27in)<br>>       height: 1056, // 279.4mm (11in)<br>>     };<br>> ```<br><br>このコメントに書いているとおり、fallbackPageSize はA4サイズとLetterサイズの折衷としました。どちらの用紙サイズを使うユーザーも印刷するのに困らないように。</blockquote>|
