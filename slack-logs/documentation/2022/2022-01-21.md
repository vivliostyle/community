# 2022-01-21

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|02:34|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|<blockquote>-   その中でも目玉と言えるのは、両プロダクトでJavaScriptが使えるようになったこと</blockquote>「両プロダクトでJavaScriptが使えるようになったこと」→ 修正案：「VivliostyleのCSS組版でJavaScriptが使えるようになったこと」<br><br>もともとVivliostyleはJavaScriptを使って組版しているものです。今回新しいのは、CSS組版対象の文書に指定された任意のJavaScriptコードを有効にしたことです。<br>ですので、「プロダクトでJavaScriptが使えるようになった」ではなくて「CSS組版でJavaScriptが使えるようになった」のほうが適切だと思います。<br><br><blockquote>-   従来はおもにセキュリティへの懸念から、HTMLにJavaScriptのコードが含まれていたら、すべて削除していた<br>-   しかし、これは用途を狭めてしまう。そこで、オプションによりJavaScriptの利用を可能にすることにした</blockquote>「おもにセキュリティへの懸念から…削除していた」は違います。サポートするのが簡単ではないから無視していたということです。<br>ですから、この部分は削除するとよいでしょう。「オプションによりJavaScriptの利用を可能に」というのも違います。デフォルトで有効にしたので逆です「オプションによりJavaScriptを無効できる」です。<br><br>Vivliostyleの組版処理は（もとの adaptive-layout 実装から）、組版対象のHTML文書を読み込んでそれをもとにしてブラウザで表示するためのDOMツリー（HTML構造の内部表現）を作っていくものです。<br>その過程でHTML文書のscript要素は無視されていました。もしもそれを無視しないで単純にDOMツリーに出力するようにしたとしても、ほとんどまともに機能することはなくて、予期しない結果になります。<br>Vivliostyleが生成する組版結果のHTML構造は、もとの組版対象のHTML構造とは違うので、JavaScriptライブラリが想定している、普通にHTML文書をブラウザで開いた場合とはいろいろ条件が合わないためです。<br><br>今回のJavaScriptサポートでも、まだまだ問題があり、とりあえず次のように動くようにしているというものです：<br>- 主なWebフォントサービスのJavaScriptコードが動き、正常にWebフォントを使った組版ができること<br>- Webフォント以外で、組版結果に影響するようなJavaScriptの場合、Vivliostyleでのページ分割など組版処理が終わったあとにそのJavaScriptの処理がされるために、結果としてページ分割位置が不適切でページから内容がオーバーフローする組版不具合が起きることがある。これを回避するためには、JavaScriptによって内容が生成されるようなブロックのサイズをあらかじめ固定にするなどの工夫が必要。<br><br><blockquote>-   2. @importかlink要素で外部スタイルシートをロードする方法（DynaSmart、Google Fonts）<br>-   3. JavaScriptによる方法（DynaSmart、Adobe Fonts、TypeSquare、FONT PLUS、 REALTYPE）</blockquote>「DynaSmart」というのはDynaFontのDynaFont年間ライセンス商品の名前なので、「DynaFont」と書く方がよいと思います。<br>「FONT PLUS」はスペースを入れない「FONTPLUS」が正しいようです。<br><br>REALTYPE は今回テストしていません。たぶん対応できてません。（Webフォントが表示されない、組版不具合が起きるなど）<br><br><blockquote>-   FONT PLUS、DynaSmartは、利用に当たってドメイン登録が必要</blockquote>今回テストした中では、「DynaFont」「FONTPLUS」「TypeSquare」がドメイン登録が必要です。<br><br><blockquote>-   具体的には、以下の方法で利用可能になる</blockquote>Webフォントサービスによって、ドメイン登録（URL登録）が微妙に違います。これについて、あらためて調べてレポートします。少々お待ちください。|
|02:34|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: &amp; gt; --The highlight is that both products can now use JavaScript.<br>"JavaScript can now be used in both products" → Amendment: "JavaScript can now be used in CSS formatting of Vivliostyle"<br><br>Originally, Vivliostyle was typeset using JavaScript. What's new this time is that we have enabled any JavaScript code specified in the document to be CSS formatted.<br>Therefore, I think it is more appropriate to say "JavaScript can be used with CSS typesetting" rather than "JavaScript can be used with the product".<br><br>&amp; gt; --In the past, mainly due to security concerns, if the HTML contained JavaScript code, it was deleted altogether.<br>&amp; gt; --But this narrows the use. Therefore, we decided to enable the use of JavaScript as an option.<br>"Mainly because of security concerns ... I deleted it" is different. I was ignoring it because it wasn't easy to support.<br>Therefore, it is a good idea to delete this part. It is also different from "allowing JavaScript to be used as an option". Since it is enabled by default, it is the opposite. "JavaScript can be disabled by option".<br><br>Vivliostyle's typesetting process (from the original adaptive-layout implementation) reads the HTML document to be typeset and creates a DOM tree (internal representation of the HTML structure) to be displayed in the browser based on it. is.<br>In the process, the script element of the HTML document was ignored. If you don't ignore it and simply print it to the DOM tree, it won't work very well and you'll get unexpected results.<br>Since the HTML structure of the typesetting result generated by Vivliostyle is different from the HTML structure of the original typesetting target, various conditions are not met as expected by the JavaScript library when the HTML document is normally opened in the browser. is.<br><br>Even with this JavaScript support, there are still problems, and for the time being, I am trying to make it work as follows:<br>――The JavaScript code of the main web font service works, and you can typeset using web fonts normally.<br>--In the case of JavaScript other than web fonts that affects the typesetting result, the JavaScript processing is performed after the typesetting process such as page break in Vivliostyle is completed, and as a result, the page break position is inappropriate and the page is paged. A typesetting problem may occur in which the content overflows from. In order to avoid this, it is necessary to devise such as fixing the size of the block whose contents are generated by JavaScript in advance.<br><br>&amp; gt; --2. How to load an external stylesheet with @import or link element (DynaSmart, Google Fonts)<br>&amp; gt; --3. JavaScript method (DynaSmart, Adobe Fonts, TypeSquare, FONT PLUS, REALTYPE)<br>"DynaSmart" is the name of DynaFont's annual licensed product of DynaFont, so I think it's better to write "DynaFont".<br>"FONT PLUS" seems to be correct with "FONT PLUS" without spaces.<br><br>REALTYPE has not been tested this time. Maybe I can't handle it. (Web fonts are not displayed, typesetting problems occur, etc.)<br><br>&amp; gt; --FONT PLUS and DynaSmart require domain registration to use<br>In this test, "DynaFont", "FONTPLUS" and "TypeSquare" require domain registration.<br><br>&amp; gt; --Specifically, it can be used by the following methods.<br>Domain registration (URL registration) differs slightly depending on the web font service. I will investigate and report on this again. please wait a little bit.|
|03:21|![](https://avatars.slack-edge.com/2019-11-22/845042642576_070441337abaca9fb7b3_72.png)|ogwata|ありがとうございます。お答えにより今まで不明確だった部分がクリアになって気がします。<br><br><blockquote>Webフォントサービスによって、ドメイン登録（URL登録）が微妙に違います。これについて、あらためて調べてレポートします。少々お待ちください。</blockquote>了解です。ひとまず書き進め、必要があれば改訂します。|
|03:21|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: thank you. I feel that the answer has cleared the parts that were unclear until now.<br><br>&amp; gt; Domain registration (URL registration) is slightly different depending on the web font service. I will investigate and report on this again. please wait a little bit.<br>I got it. I will write it for the time being and revise it if necessary.|
|06:34|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|DynaFont、FONTPLUS、TypeSquare のサイト登録（ドメイン登録）についてチェックし直しました。<br><br>*## DynaFont*<br><br>DynaFontでは「localhost」はドメイン登録しなくても使えます。DynaFontのFAQにありました:<br><https://www.dynacw.co.jp/support/support_faq_detail.aspx?qid=456&amp;fcid=223><br><br><blockquote>Q：ローカル環境でWebフォントを使うことはできますか？<br>Answer：ローカル環境での開発のご要望に応えて、DynaFont Onlineではローカルサーバー上でWebフォントを表示することができます。ご自身のPCにローカルサーバーを構築いただき、localhostフォルダに該当のHTMLファイル及びCSSファイルを置くことで、ブラウザから <https://localhost/> にアクセスいただくと、Webフォントをご確認いただくことができます</blockquote>とのことなので、Vivliostyle CLI で --http オプションをつけて利用するには「localhost」を明示的にドメイン登録する必要もないようです。<br>（私は「localhost」をドメイン登録してDynaFontをテストしてました。いったんドメイン登録したら削除できないようで、「localhost」を登録してなくても使えることはテストできてません。よろしければその確認お願いしたい）<br><br>localhost以外でVivliostyle Viewerを使う場合は、Vivliostyle ViewerのURLのドメイン名を登録します。<br>（例えば、Canary版Vivliostyle Viewerなら「<http://vivliostyle.vercel.app|vivliostyle.vercel.app>」）<br><blockquote>ダイナコムウェア株式会社: ローカル環境でWebフォントを使うことはできますか？ | フォント・書体の開発及び販売 ｜ ダイナコムウェア株式会社</blockquote>|
|06:34|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: I rechecked the site registration (domain registration) of DynaFont, FONTPLUS, and TypeSquare.<br><br>*## DynaFont *<br><br>In DynaFont, "localhost" can be used without registering the domain. It was in the DynaFont FAQ:<br><https://www.dynacw.co.jp/support/support_faq_detail.aspx?qid=456&amp;fcid=223><br><br>&amp; gt; Q: Is it possible to use web fonts in the local environment?<br>&amp; gt; Answer: In response to requests for development in the local environment, DynaFont Online can display web fonts on the local server. By building a local server on your own PC and placing the corresponding HTML file and CSS file in the localhost folder, you can check the web font by accessing &lt;https: // localhost /&gt; from your browser. increase<br><br>So, it seems that it is not necessary to explicitly register "localhost" as a domain in order to use it with the --http option in Vivliostyle CLI.<br>(I registered "localhost" as a domain and tested DynaFont. Once I registered the domain, it seems that it cannot be deleted, and I can not test that it can be used without registering "localhost". If you like, that I want to confirm)<br><br>If you want to use Vivliostyle Viewer other than localhost, register the domain name of the URL of Vivliostyle Viewer.<br>(For example, for the Canary version of Vivliostyle Viewer, "<http://vivliostyle.vercel.app | vivliostyle.vercel.app>")|
|06:37|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|*## FONTPLUS*<br><br>「サイトURL」を登録します（「https://」なども含める）<br>Vivliostyle CLI で --http オプションをつけて利用するには「<http://localhost:13000/>」を登録するとよいです。|
|06:37|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: *## FONTPLUS *<br><br>Register the "site URL" (including "https: //" etc.)<br>To use the Vivliostyle CLI with the --http option, register "&lt;http: // localhost: 13000 /&gt;".|
|06:45|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|*## TypeSquare*<br><br>利用サイトURLの登録というところで登録するのは「https://」などは付けないドメイン名です。<br>Vivliostyle CLI で --http オプションをつけて利用するには「localhost」を登録するとよいです。|
|06:45|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: *## TypeSquare *<br><br>When registering the URL of the site to be used, the domain name to be registered is a domain name without "https: //".<br>To use it with the --http option in the Vivliostyle CLI, register "localhost".|
|07:08|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|Vivliostyle Viewerのドメイン名と組版対象のドメイン名とが異なる場合、注意が必要です。<br>（Vivliostyle CLIで --viewer オプションでViewerのURLを指定した場合や、組版対象としてWebの文書のURLを指定した場合、このケースになります）<br><br>DynaFontのテスト<br><https://vivliostyle.vercel.app/#src=https://gist.githack.com/MurakamiShinyu/87be192c14d3226499237ab554ae687a/raw/dynafont-test1.html><br><br>FONTPLUSのテスト<br><https://vivliostyle.vercel.app/#src=https://gist.githack.com/MurakamiShinyu/66046b918a3783e58fb41053b338b234/raw/fontplus-test1.html><br><br>TypeSquareのテスト<br><https://vivliostyle.vercel.app/#src=https://gist.githack.com/MurakamiShinyu/d2781adcb39e4ec2a831a4285f17e1a9/raw/typesquare-test1.html><br><br>これらのテストで、いずれもVivliostyle Viewerのドメイン名は `<http://vivliostyle.vercel.app|vivliostyle.vercel.app>` で組版対象のドメイン名は `<http://gist.githack.com|gist.githack.com>` です。<br><br>DynaFontとFONTPLUSの場合は、Vivliostyle Viewerのドメイン名の `<http://vivliostyle.vercel.app|vivliostyle.vercel.app>` を登録する必要があります。組版対象のURLは、Vivliostyle ViewerのURLのパラメータについている文字列にすぎないのでこれが当然です。<br><br>しかし、興味深いことに、TypeSquareの場合には組版対象のドメイン名の `<http://gist.githack.com|gist.githack.com>` のほうを登録する必要があります。（テストした結果分かったことです。）<br>TypeSquareでのWebフォントを利用するサイトのURLのチェックがちょっと癖があって、WebページのURL内に `https://…` のような文字列パターンが複数あると、最初のものではなくて最後のものを登録されているURLと一致するかテストしています。それが意図的なのかバグなのかは不明です。|
|07:08|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: Be careful when the domain name of Vivliostyle Viewer and the domain name to be formatted are different.<br>(This is the case if you specify the URL of the Viewer with the --viewer option in the Vivliostyle CLI, or if you specify the URL of the Web document as the formatting target.)<br><br>DynaFont test<br><https://vivliostyle.vercel.app/#src=https://gist.githack.com/MurakamiShinyu/87be192c14d3226499237ab554ae687a/raw/dynafont-test1.html><br><br>FONTPLUS test<br><https://vivliostyle.vercel.app/#src=https://gist.githack.com/MurakamiShinyu/66046b918a3783e58fb41053b338b234/raw/fontplus-test1.html><br><br>Type Square test<br><https://vivliostyle.vercel.app/#src=https://gist.githack.com/MurakamiShinyu/d2781adcb39e4ec2a831a4285f17e1a9/raw/typesquare-test1.html><br><br>In these tests, the domain name of Vivliostyle Viewer is `<http://vivliostyle.vercel.app|vivliostyle.vercel.app>` and the domain name to be formatted is `<http://gist.githack.com. | gist.githack.com> `.<br><br>For DynaFont and FONTPLUS, you need to register the Vivliostyle Viewer domain name `<http://vivliostyle.vercel.app|vivliostyle.vercel.app>`. This is natural because the URL to be formatted is just the character string attached to the parameter of the URL of Vivliostyle Viewer.<br><br>Interestingly, however, in the case of TypeSquare, you need to register the domain name to be formatted, `<http://gist.githack.com | gist.githack.com>`. (I found out as a result of the test.)<br>Checking the URL of a site that uses web fonts in TypeSquare is a bit quirky, and if there are multiple string patterns such as `https: //…` in the URL of the web page, it is not the first one. We are testing if the last one matches the registered URL. It's unclear if it's intentional or a bug.|
|07:54|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|<blockquote>TypeSquareでのWebフォントを利用するサイトのURLのチェックがちょっと癖があって、WebページのURL内に `https://…` のような文字列パターンが複数あると、最初のものではなくて最後のものを登録されているURLと一致するかテストしています。それが意図的なのかバグなのかは不明です。</blockquote>これはたぶん、TypeSquareのバグだと思う。<br>このバグによって、TypeSquareに登録していないサイトでも、TypeSquareのWebフォントが使えてしまいます。<br>たとえば私は `<http://gist.githack.com|gist.githack.com>` を登録してそれ以外は登録していない（TypeSquareの無料のトライアル版では１つしか登録できないので）のだけど、ほかのサイトでもそのURLのあとに `?<https://gist.githack.com>` や `#<https://gist.githack.com>` を付けるとWebフォントが有効になります。例 <https://murakamishinyu.github.io/bugtest/webfonts/typesquare-test1.html?https://gist.githack.com>|
|07:54|![](https://avatars.slack-edge.com/2021-08-02/2324149410423_2aa7423c4133ecb9f168_72.png)|Kiara : Translation 100+ Languages|🇬🇧: &amp; gt; If you have a habit of checking the URL of a site that uses web fonts in TypeSquare, and there are multiple string patterns such as `https: //…` in the URL of the web page, the first one will be We are testing if the last one does not match the registered URL. It's unclear if it's intentional or a bug.<br>I think this is probably a TypeSquare bug.<br>This bug allows you to use TypeSquare web fonts even on sites that are not registered with TypeSquare.<br>For example, I registered `<http://gist.githack.com | gist.githack.com>` and not anything else (since I can only register one in the free trial version of TypeSquare). , For other sites, add `? <Https://gist.githack.com>` or `# <https://gist.githack.com>` after the URL to enable web fonts. Example <https://murakamishinyu.github.io/bugtest/webfonts/typesquare-test1.html?https://gist.githack.com>|
