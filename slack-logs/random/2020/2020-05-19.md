# 2020-05-19

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|18:02|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|I wrote a proposal to CSS Text 3 Segment Break Transformation Rules<br><https://github.com/w3c/csswg-drafts/issues/5086><br><blockquote>(There are related discussion in <https://github.com/w3c/csswg-drafts/issues/4992|#4992>, <https://github.com/w3c/csswg-drafts/issues/5017|#5017>, and <https://github.com/w3c/jlreq/issues/211|w3c/jlreq#211>)<br><br>(I wrote about this topic in Japanese at <https://lists.w3.org/Archives/Public/public-i18n-japanese/2020AprJun/0232.html|https://lists.w3.org/Archives/Public/public-i18n-japanese/2020AprJun/0232.html> and its thread)<br><br>When I write Japanese text with manual line breaks, I prefer to insert line breaks after ideographic/fullwidth full stop or comma [。、．，] rather than between Kanji/Hiragana/Katakana letters, because full stop and comma are break points in thought and I can naturally press the Enter key there. So it is very important to be able to put line breaks after CJK punctuation, without causing extra space. This is not just my personal preference, but common to many people, I guess. (I believe it's same for Chinese, and also for Korean when using CJK punctuation.)<br><br>e.g.,<br><br><pre>日本語のテキストに、<br>English textを埋め込む。<br></pre><br><br>should be transformed to<br><br><pre>日本語のテキストに、English textを埋め込む。<br></pre><br><br>and not to<br><br><pre>日本語のテキストに、 English textを埋め込む。<br></pre><br><br>However, the current draft's <https://drafts.csswg.org/css-text-3/#line-break-transform|Segment Break Transformation Rules> do not meet this requirement. According to these rules, the segment break is discarded only if both the characters before and after the segment break belong to the space-discarding character set, and converted to a space otherwise.<br><br>*Line break treatment in TeX with CJK support*<br><br>TeX has been used for Japanese typesetting since a Japanese TeX, pTeX, was developed in 1987. The pTeX and its derivatives and successors have the following line break treatment:<br><br>• If the character before the line break is a Japanese character, then the line break is removed.<br>• Otherwise, the line break is converted to a space.<br><br>This is the de facto standard for Japanese TeX users over the last 30 years.<br><br>(See <http://ftp.jaist.ac.jp/pub/CTAN/macros/luatex/generic/luatexja/doc/luatexja-en.pdf|LuaTEX-ja document>, "13 Linebreak after a Japanese Character", for details)<br><br>With this rule, authors can put line break after Japanese punctuation, without causing extra space when a non-Japanese character follows the line break. So I think this rule has an advantage over the current CSS draft.<br><br>I am not a TeX expert and only have a limited knowledge about Japanese TeX. So I <https://twitter.com/MurakamiShinyu/status/1260131650509262850|asked TeX experts on twitter> and got some useful information.<br><br>• <https://twitter.com/watayan/status/1260142719562731525|https://twitter.com/watayan/status/1260142719562731525><br>    <br>    &gt; (Translation from Japanese) When writing in TeX, I appreciate the rule of "depending on the character at the end of a line". And when writing HTML, I put line breaks only where extra space is tolerable, with a feeling of giving up.<br><br>Such Japanese users will be disappointed if the Segment Break Transformation Rules cause extra space between Japanese punctuation and non-Japanese character.<br><br>• <https://twitter.com/zr_tex8r/status/1260150913118818304|https://twitter.com/zr_tex8r/status/1260150913118818304><br>    <br>    &gt; (Translation from Japanese) In the case of "XeLaTeX + xeCJK package" which is a "TeX for Chinese" widely used in China, the rule (simplified) is "Ignore line break if both before and after the line break are CJK" by default. It can be changed by setting.<br>    <br>    • <https://twitter.com/zr_tex8r/status/1261663712076685313|https://twitter.com/zr_tex8r/status/1261663712076685313><br>        <br>        &gt; (Translation from Japanese) I tried to typeset the following sources in the default settings of xeCJK. Unexpectedly, all three outputs are same: "no extra space occurs".<br>        <br>        <pre>        中文。 English。<br>        <br>        中文。English。<br>        <br>        中文。<br>        English。<br>        <br>        <br>This behavior in "XeLaTeX + xeCJK package" is very interesting to me. I found the following description in the <http://ftp.jaist.ac.jp/pub/CTAN/macros/xetex/latex/xecjk/README.md|README of xeCJK>:<br><br><blockquote>• Spaces automatically ignored between CJK characters.<br>• Special effects on full-width CJK punctuation.<br>• Automatic adjustment of the space between CJK and other characters.</blockquote>In XeLaTeX + xeCJK, line breaks in the source are treated as spaces and spaces are ignored between two CJK characters. In addition, spaces are ignored between a CJK punctuation and a non-CJK character, as one of the "Special effects on full-width CJK punctuation". Same as Japanese TeX (pTeX etc.), authors can put line break after CJK punctuation without causing extra space when a non-CJK character follows the line break.<br><br>*Proposal to fix Segment Break Transformation Rules*<br><br>I propose to add one rule to the <https://drafts.csswg.org/css-text-3/#line-break-transform|Segment Break Transformation Rules> before the last "Otherwise … converted to a space":<br><br>• Otherwise, if either the character before or after the segment break belongs to the space-discarding character set and is a Unicode Punctuation (P*) or Space Separator (Zs), then the segment break is removed.<br><br>(U+3000, ideographic space, is probably the only character that belongs to the space-discarding character set and is a Space Separator Zs)<br><br>With this rule, no extra space occurs in the following examples:<br></pre><br>日本語のテキストに、<br>English textを埋め込む。<br><br><pre><br>↓<br></pre><br>日本語のテキストに、English textを埋め込む。<br><br><pre></pre><br>日本語のテキストにEnglish text<br>（英語のテキスト）<br>を埋め込む。<br><br><pre><br>↓<br></pre><br>日本語のテキストにEnglish text（英語のテキスト）を埋め込む。<br><br><pre><br>(In this example, fullwidth parentheses are used)<br></pre><br>日本語のテキスト！　<br>English textを埋め込む。<br><br><pre><br>↓<br></pre><br>日本語のテキスト！　English textを埋め込む。<br><br>```<br><br>(In this example, there is an ideographic space U+3000  after the `！`)</blockquote>|
|18:02|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇯🇵: CSS Text 3 Segment Break Transformation Rulesへの提案を書いた<br><https://github.com/w3c/csswg-drafts/issues/5086>|
|18:04|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|日本語での議論はここに:<br><https://lists.w3.org/Archives/Public/public-i18n-japanese/2020AprJun/0232.html>|
|18:04|![](https://avatars.slack-edge.com/2019-08-21/732685848020_f3f20736795184660348_72.png)|Kiara Translation|🇬🇧: Discussions in Japanese are here:<br><https://lists.w3.org/Archives/Public/public-i18n-japanese/2020AprJun/0232.html>|
