# 2024-02-13

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|05:58|![](https://avatars.slack-edge.com/2019-11-22/845042642576_070441337abaca9fb7b3_72.png)|ogwata|みなさん<br><br>昨日はご参加ありがとうございました。<br>2月開発者会議の議事録を下記に公開しました。<br><br><https://github.com/vivliostyle/community/issues/121><br><br>今回はいつも採録してくださっている`@akabeko` さんが体調不良で不参加でした。<br>そこで私が採録しましたので、いつものようなSlackのログではありません。<br><br>なにか過不足があれば、ぜひご指摘ください！<br><blockquote>• Meeting Log<br><br>*Agenda*<br><br>• *Vivliostyle.js*（<https://github.com/MurakamiShinyu|@MurakamiShinyu>）<br>    • <https://github.com/vivliostyle/vivliostyle.js/compare/v2.25.9...v2.26.0|2.26.0> (2024-01-20)<br>        • CSSのテキストスペーシングプロパティ変更の反映（<https://github.com/vivliostyle/vivliostyle.js/issues/1251|#1251>）<br>            • デフォルトで行頭を詰めなくした（段落冒頭、折り返しともに行頭は何もしない）<br>            • 理由はWebとの互換性等<br>            • 詰めたい場合は自分で指定する<br>        • バグの修正<br>    • <https://github.com/vivliostyle/vivliostyle.js/compare/v2.26.0...v2.27.0|2.27.0> (2024-02-09)<br>        • <https://github.com/vivliostyle/community/blob/main/slack-logs/meeting-log/2023/2023-03-05.md|1年前からの予告>どおり、デフォルトスタイルシートをWeb標準に従ったものへ変更（ <https://github.com/vivliostyle/vivliostyle.js/issues/1128|#1128>）<br>            • 見出しのマージンの値変更<br>            • ブロッククォートとリストの前後のマージン等をゼロだったものを、標準どおり1emのマージンをつけるように変更<br>            • なお、ネストされたセクション要素内でh1要素のサイズを変更する動作は不採用にした<br>                • これはHTML5の確立前の段階の考え方で、現在は推奨されていないので不採用とした<br>        • 目次要素を目次として処理する過程のバグを修正（ <https://github.com/vivliostyle/vivliostyle.js/issues/1258|#1258>）<br>    • 今後の予定<br>        • <https://github.com/vivliostyle/vivliostyle.js/issues/1256|#1256>などのバグがあるので、それを今後フィクスしていく予定<br>            • 1つのブロックの中に長いテキストがあると処理に時間がかかってしまう<br>• *Vivliostyle CLI*（<https://github.com/spring-raining|@spring-raining> , <https://github.com/MurakamiShinyu|@MurakamiShinyu>）<br>    • <https://github.com/vivliostyle/vivliostyle-cli/compare/v8.6.0...v8.7.0|8.7.0> (2024-01-22)<br>        • 前月指摘分の修正<br>            • EPUBの出力時に圧縮するようにした<br>            • EPUのなかに含まれていた不要なファイルを削除するようにした<br>    • <https://github.com/vivliostyle/vivliostyle-cli/compare/v8.7.0...v8.8.0|8.8.0> (2024-02-09)<br>        • Vivliostyle.jsのアップデート（<https://github.com/vivliostyle/vivliostyle.js/compare/v2.26.0...v2.27.0|2.27.0>）にともなうもの<br>    • <https://github.com/vivliostyle/vivliostyle-cli/issues/469|TOC in webpub should be converted to in EPUB output #469><br>        • 文書内に `<nav role="doc-toc">` などのマークアップで目次を入れることで、Vivliostyle Viewer の目次メニューや出力したPDFの「しおり」には目次ができるのに、EPUB出力ではそれがEPUBの目次にならない問題<br>        • 現状の分析<br>            • なぜこうなるかというと、元のHTMLにあった`<nav class="toc" role="doc-toc">`とは別に、body要素の終わりにnav要素が追加されており、そこには目次項目としてtitleしか入っていないから<br>            • landmarksにおける目次のリンク先が文書内の目次ページであるべきなのに、hidden属性で非表示になっている部分EPUB用の nav 要素になっている<br>        • 修正の提案<br>            • ⓵元の文書内にEPUB用の目次 `<nav epub:type="…">` がある場合はそれをそのまま活かし、別のnav要素を追加しない。<br>                • epub:type属性の値は `"toc"`, `"landmarks"`, `"page-list"` に限らず何でも有効とする (See: <https://www.w3.org/TR/epub-33/#sec-nav-def-types-other|https://www.w3.org/TR/epub-33/#sec-nav-def-types-other>)<br>            • ⓶EPUB用ではない目次（`<nav role="doc-toc">` など）が元の文書内にあれば、その内容を使ってEPUB用の目次 を作る。<br>                • 目次要素の検出については <https://github.com/vivliostyle/vivliostyle.js/blob/master/packages/core/src/vivliostyle/toc.ts#L47|Vivliostyle.jsの findTocElements() の処理>（最近 <https://github.com/vivliostyle/vivliostyle.js/pull/1259|Improve TOC handling vivliostyle.js#1259> と <https://github.com/vivliostyle/vivliostyle.js/pull/1271|fix: All> elements in EPUB navigation doc should be shown in TOC box vivliostyle.js#1271 で修正したもの）を参考にする。<br>                • EPUB用の目次の仕様ではリストの要素として `<ol>` しか認められていないが、Webpub用の目次では `<ol>`, `<ul>` とも有効なので、EPUB用の目次に変換するには `<ul>` を `<ol>` に変える<br>            • ⓷`<nav epub:type="landmarks">` で目次へのリンクを出力する場合、そのリンク先は文書内に元からある目次の要素（hidden 属性なし）とする。<br>            • ⓸`<nav epub:type="landmarks">` は `<nav epub:type="toc">` のあとに出力する<br>                • Vivliostyle ViewerでTOC Boxで出現順に表示される。<br>                • landmarksよりも目次が最初にあるほうが便利。<br>            • ⓹各 要素内に見出しがあったほうがよい。<br>                • 例： `<h2>Table of Contents</h2>`、`<h2>Landmarks</h2>`。<br>        • ディスカッション<br>            • はるさめ：指摘のような動作になっている理由<br>                • EPUBの出力はWebpubへの変換を経由しているが、その際にpublication.jsonを参照するようにしている<br>                • なので提案に対応するにはWebpubに変換するタイミングで対応しなければならず、処理が多くなりそう<br>                • 提案⓵：nav要素を追加しないは問題ない<br>                • 提案⓶：`<nav role="doc-toc">`がある場合の対応は、どの程度優先度をあげるか悩む<br>                    • もともとVivliostyle CLIの目次作成機能が貧弱だからという問題に対応するもの、なのでこれを解決すればよいかも<br>                    • あるいは目次作成機能を別途切り出し、それをCLIで利用するという手もある<br>                • 提案⓸：landmarksをTOCの後にすべきのはその通り<br>                • 提案⓹：見出しをつけるのもその方がよいと思う<br>                • 提案⓷について質問：これはhidden属性をとってほしいということか？<br>            • 村上：提案⓷のlandmarksでの目次へのリンクの問題は、通常どおり組版する目次と、アプリのUIで使う目次が別々にある場合に、アプリのUIで使う目次（組版に出ないようにhidden属性がある）のほうにリンクされているという問題<br>                • landmarksに入れるのは組版結果に出る目次へのリンクであるべきなので、現在の実装は意味がないことになる<br>                • それを実現するには提案2の機能を実装する必要あるので、それができない場合はリンクを無効にする対応をとった方がよい<br>                • ul要素でなくol要素にするのはMarkdownで使いづらい問題あり<br>                    • 目次を書く時にハイフンを使わずに、数字を使って書かないといけなくなり面倒<br>            • はるさめ：まとめると、提案のうち⓵と⓸、⓹は対応、提案⓷はランドマークをなくすのはリンクを無効にする消極的対応をとる<br>                • 提案⓶はCLIの目次作成を強化することで対応する方法と、Vivliostyle.jsで対応する方法あり<br>            • 村上：Vivliostyle.jsの目次機能において、EPUB互換である目次作成機能もサポートするということ？<br>            • はるさめ：直接EPUB対応の目次を作る必要はないが、Vivliostyle.jsの方で階層的な情報やハイパーリンクの情報が分かるようにしてくれるとうれしい（APIなどを想定）<br>            • 村上：そもそもブラウザの中での話しなので、それとは別にVivliostyle.jsの中でやるのは困難<br>                • そんなに複雑に解析する必要はなく、Vivliostyle.jsの目次よりも簡易に、`<nav role="doc-toc">`があればその内容をコピーしてEPUB用の目次を生成し、そのうちul要素だけはol要素に変えるようにすればよいのでは<br>                • 目次の自動生成機能とWebpub用の目次機能が両方できればよいのでは<br>            • はるさめ：了解。目次の自動生成という位置づけでCLIで実装して、結果としてEPUB生成の機能強化にもなるという感じで対応を検討する<br>                • 2つめは目次機能の強化にもなる（Vivliostyle Viewerよりも深い階層の見出しを目次項目にできる）。<br>            • 村上：見出しのうちどのレベルまで目次で反映するかパラメータが必要になる<br>                • わりと時間がかかりそう<br>• *Theme* (<https://github.com/spring-raining|@spring-raining>)<br>    • 細かいアップデートを報告<br>        • 先日themeのmanifestファイルのcommitをした（<https://github.com/vivliostyle/themes/pull/122|fix: Add a main property for package.json>）<br>        • メインフィールドを追加することで動く環境が増える<br>            • <https://unpkg.com/|UNPKG>（アンパッケージ）<br>        • 今までだとthemeの名前まで指定する必要あったが、メインフィールドを参照して指定なしに参照できる<br>        • もう一つ、実装中なのはthemeで今までの書き方は冗長だった問題を解決したい<br>            • <https://postcss.org/|PostCSS>というライブラリを利用<br>                • アップデート後に、themeのコントリビュータ向けにドキュメントを改訂する必要あり<br>                • PostCSSを使う場合、コンパイルが必要になる懸念あり<br>                • メリットはあるがビルドのステップが追加されるデメリットは理解できる<br>                • プラグインを使う処理として、オプショナルにする予定<br>        • 村上：脇に逸れる質問だが、CSSのネスティングの機能やレイヤーなども拡張されている中で、Vivliostyle.jsでもネスティングへの対応が課題だが、それらはどのくらい必要か？<br>        • はるさめ：Vivliostyleのパースの部分まで外部のライブラリを使うのはありではないか？<br>        • 村上：できるかもしれないが、外部ライブラリを使う場合、Vivliostyleの実装と両立できるかどうか、慎重な検討が必要。<br>            • 場合によっては自前で実装した方が早い<br>            • 基本的にネスティング対応は頑張れば可能であることは分かっている<br>            • ただ、それなりに面倒。とはいえ、やらないとブラウザと違いが出る<br>            • CSSネスティングができるとCSSの書き方が変わる。今後手をつけたい<br>• *VFM, create-book, vivliostyle-sitegen*（<https://github.com/akabekobeko|@akabekobeko>）<br>    • 前月からの報告と今後の予定<br>    • なし<br>• *Vivliostyle Pub*（<https://github.com/takanakahiko|@takanakahiko>, <https://github.com/MurakamiShinyu|@MurakamiShinyu>）<br>    • 前月からの報告と今後の予定<br>    • なし<br>• <http://gihyo.jp|gihyo.jp> Web連載について（*<https://github.com/U-1F992|@U-1F992>*）<br>    • <https://gihyo.jp/article/2024/01/vivliostyle-01|Vivliostyleでなにができるの？ ｜><http://gihyo.jp|gihyo.jp><br>    • データはまだ、次回報告したい<br>    • 「いいね」はそれなりについている（現在169）、周りの記事に比べても多い方<br>• *yamahige*から質問<br>    • SlackのIssueチャンネルとGitHubのIssueとの使い分けは？<br>        • 村上：Issueは実際の開発と結びついているのはGitHubIssue<br>        • Slackの方はもっとくだけた用途、何を書いてよいか分からない場合の相談等<br>        • GitHubのIssueにまとめるに至らないものはSlack<br>        • yamahige：Slackの<https://vivliostyle.slack.com/archives/CJAP6GBKQ/p1707573820741269|#Issueに投稿した>が、本当にここでよいか自信がない<br>        • 村上：見落としていたので返事する<br>    • yamahige：Vivliostyle以外のCSS組版ツールでのCSSのサポート状況を知るには？<br>        • 村上：各サイトのドキュメントを参照するのが一番<br>            • pagefloatに関しては、W3Cの仕様にもとづいた実装はVivliostyleくらいだけ<br>            • 他のものは独自実装、アンテナハウスは充実している<br>            • princeも機能はあり、それなりにできている、<br>            • この3つがpagefloatを使えるが、それぞれ微妙に違うのでそれぞれのドキュメントを参照する必要あり、標準化がちゃんとされていない状態<br>            • Vivliostyleも修正したところがあるけど放置しているのが実際、不具合もある、一応使えるので使ってみてください。他もオプションあり得る<br>        • yamahige：論文観点なのでVivliostyle一択でしょみたいなことが言えればよいと思ったが？<br>        • 村上：アンテナハウスなどは業務向けの高価な製品なので、学生向けは想定外で無理がある<br>            • オープンソース以外は負担が大きいのは皆同じではないか<br>            • その意味でオープンソースであるVivliostyleは向いていると言えるのでは<br>            • 最新のドラフトに一番近いのはVivliostyle、<br>            • また、その他のWeb仕様に近いのもVivlios…</blockquote>|
