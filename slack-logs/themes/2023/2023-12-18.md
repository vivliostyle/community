# 2023-12-18

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|07:58|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|`@spring-raining` PR確認・マージありがとうございます。<br>npmリリースしようと思います。<br>themesのルートで次を実行するとよいですね？<br>```yarn up<br>yarn release```<br>リリースの前に依存関係の更新をしました：<br><https://github.com/vivliostyle/themes/commit/da19c8d34aba3b8d8f13de2e2eb8b9e87068c18d><br>（typescript と vfm を最新に）|
|08:43|![](https://secure.gravatar.com/avatar/1ac180f0868137292905c311b5fff781.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2Fdf10d%2Fimg%2Favatars%2Fava_0021-72.png)|spring-raining|あ、手順が変わってるかもしれないのでこちらでリリース作業しておきます！ 後でドキュメントも更新します|
|08:43|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|お願いします！|
|10:13|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|このEPUB用テーマを作ったとき気になった問題：<br><https://github.com/vivliostyle/themes/issues/119><br><blockquote>このリポジトリではpackage.jsonの次の設定によってcommit時にprettierによる整形が実行されるようになっている：<br><br><https://github.com/vivliostyle/themes/blob/da19c8d34aba3b8d8f13de2e2eb8b9e87068c18d/package.json#L34-L38|themes/package.json><br><br>Lines 34 to 38 in </vivliostyle/themes/commit/da19c8d34aba3b8d8f13de2e2eb8b9e87068c18d|da19c8d><br><br>各テーマパッケージのexampleの原稿MDファイルに対してこれが適用されて次のように意図しない書き換えがされてしまうことがある：<br><br>• 和文文字と欧文文字との間にスペース（U+0020）が挿入される（prettier v2の問題）<br>    • 和欧文間スペースの処理はCSS組版エンジンで行われるものなので、原稿テキストにこのようなスペース文字を入れるべきではない<br>    • この問題については、prettier v3では修正されている：<br>        • <https://github.com/prettier/prettier/issues/6385|prettier/prettier#6385><br>• 意図的に入れている段落の行頭の全角スペース(U+3000)が削除される<br>    • <http://ebpaj.jp/counsel/guide|電書協EPUB3制作ガイド>では段落の字下げに全角スペースを入れる（行頭が括弧以外の場合）ことが勧められている。この形式の原稿が扱えないのは問題。<br>• VFMでの見出しの属性記法で、見出しの行のあと改行してから属性記法 `{ … }` を書いている場合（見出しの内容がインラインの要素で終わるときそうする必要がある）、改行がさらに追加されて空白行があいだにできる。そうすると見出しの属性記法ではなくなってしまい、`{ … }` がテキストとして出力されてしまう事故になる。<br><br>このうち問題のうち最初の「和文文字と欧文文字との間にスペース（U+0020）が挿入される」については、prettierのバージョンを現在使われている v2 から最新の v3 に更新すると解決するはず。しかし、commit時のprettier実行のために使われているpretty-quickがprettier v3に対応していないという問題があり、prettierを最新にするためにはpretty-quickをほかのものに置き換える必要がある。そのpretty-quickのissue:<br><br>• <https://github.com/azz/pretty-quick/issues/164|azz/pretty-quick#164><br><br>実際に問題が起きた例：<br><br>• <https://github.com/vivliostyle/themes/pull/118|#118> の電書協のEPUBサンプルをベースにMD化したサンプルをコミットしたとき、この意図しない書き換えが生じた。そのあとそれを直したコミット <https://github.com/vivliostyle/themes/commit/8c699665b587d2e7a23defac2c5765d0bc61cb68|8c69966> での差分を参照。<br><br>当面の対策としては、`.prettierignore` ファイルでMDファイルが整形対象にならないようにする。例：  <br><br><https://github.com/vivliostyle/themes/blob/da19c8d34aba3b8d8f13de2e2eb8b9e87068c18d/.prettierignore#L2|themes/.prettierignore><br><br>Line 2 in </vivliostyle/themes/commit/da19c8d34aba3b8d8f13de2e2eb8b9e87068c18d|da19c8d></blockquote>|
