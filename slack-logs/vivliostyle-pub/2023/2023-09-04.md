# 2023-09-04

|Time (UTC)|Icon|Name|Message|
|---|---|---|---|
|07:03|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|試行錯誤しながら、解決に近づいている<br><https://github.com/vivliostyle/vivliostyle-pub/pull/277#issuecomment-1704717999><br><blockquote>> ```<br>> export const webhookHandler = functions.https.onRequest(<br>>   createNodeMiddleware(webhooks, {path: '/'}),<br>> );<br>> ```<br>> <br>> これで、引数の型不一致になるのが `@octokit/webhooks` のどのバージョンからかを調べると、 v11 からであった。<br><br>引数の型不一致にならない最後の `@octokit/webhooks` バージョンである v10.9.1 を使ってテストした。(<https://github.com/vivliostyle/vivliostyle-pub/commit/0223e8a5e6a6d2b80df9f293534dd20ca4b65d8a|0223e8a>)<br><br>その結果、ログを見るとエラーは起きていないが、次のように deprecated の警告が出ている：<br><br>> [@octokit/webhooks] Passing the payload as a JSON object in `request.body` is deprecated and will be removed in a future release of `@octokit/webhooks`, please pass it as a a `string` instead.<br><br>> [@octokit/webhooks] Passing a JSON payload object to `verifyAndReceive()` is deprecated and the functionality will be removed in a future release of `@octokit/webhooks`<br><br><https://user-images.githubusercontent.com/3324737/265379907-b6366962-0e13-4f1f-bfe8-6cb330b08e71.png|スクリーンショット 2023-09-04 15 48 22></blockquote>|
|10:00|![](https://avatars.slack-edge.com/2018-04-27/354445776386_e258f5ed5ba887b08668_72.jpg)|shinyu|できた。<br><br><https://github.com/vivliostyle/vivliostyle-pub/pull/277#issuecomment-1704970501><br><blockquote>`@octokit/webhooks` を最新 12.0.3 にして、 <https://github.com/octokit/webhooks.js#createnodemiddleware|https://github.com/octokit/webhooks.js#createnodemiddleware> の例を参考に次のようにしてみた。<br><br><pre>const middleware = createNodeMiddleware(webhooks, {path: '/'});<br><br>export const webhookHandler = functions.https.onRequest(async (req, res) => {<br>  if (typeof req.body === 'object') {<br>    req.body = JSON.stringify(req.body);<br>  }<br>  if (await middleware(req, res)) return;<br>  res.writeHead(404);<br>  res.end();<br>});</pre><br><br>これで大丈夫なようだ。<br><br><https://user-images.githubusercontent.com/3324737/265424251-494dd52f-c062-4d22-a0c2-c9e0d4d6e954.png|スクリーンショット 2023-09-04 18 42 52></blockquote>|
